<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì»¬ëŸ¼ ê³ ì • (Column Pinning) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="column-pinning.html" class="active">ğŸ“Œ ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
    <a href="selection-modes.html">ğŸ¯ ì„ íƒ ëª¨ë“œ</a>
  </nav>
  
  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ“Œ ì»¬ëŸ¼ ê³ ì • (Column Pinning)</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>
  
  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>ì»¬ëŸ¼ ê³ ì •</strong>ì€ íŠ¹ì • ì»¬ëŸ¼ì„ ì™¼ìª½ ë˜ëŠ” ì˜¤ë¥¸ìª½ì— ê³ ì •í•˜ì—¬ ê°€ë¡œ ìŠ¤í¬ë¡¤ ì‹œì—ë„ 
      í•­ìƒ í™”ë©´ì— í‘œì‹œë˜ë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. <code>position: sticky</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ 
      ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥ìœ¼ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤.
    </p>
  </div>
  
  <div class="demo-container">
    <div class="toolbar">
      <div class="toolbar-group">
        <button onclick="loadData(10000)">ë°ì´í„° ë¡œë“œ</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>ì»¬ëŸ¼:</label>
        <select id="columnSelect">
          <option value="id">ID</option>
          <option value="name">Name</option>
          <option value="email">Email</option>
          <option value="department">Department</option>
          <option value="status">Status</option>
          <option value="salary">Salary</option>
          <option value="joinDate">Join Date</option>
          <option value="extra1">Extra 1</option>
          <option value="extra2">Extra 2</option>
          <option value="extra3">Extra 3</option>
          <option value="extra4">Extra 4</option>
          <option value="extra5">Extra 5</option>
        </select>
        
        <button onclick="pinColumn('left')" class="success">â† ì™¼ìª½ ê³ ì •</button>
        <button onclick="pinColumn('right')" class="success">ì˜¤ë¥¸ìª½ ê³ ì • â†’</button>
        <button onclick="unpinColumn()" class="secondary">ê³ ì • í•´ì œ</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <button onclick="resetColumns()" class="warning">ì´ˆê¸°í™”</button>
      </div>
    </div>
    
    <div id="grid"></div>
    
    <div class="status-bar" id="status">
      ì¤€ë¹„ë¨ - ê°€ë¡œë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ê³ ì •ëœ ì»¬ëŸ¼ì„ í™•ì¸í•˜ì„¸ìš”
    </div>
  </div>
  
  <!-- í˜„ì¬ ìƒíƒœ -->
  <div class="info-panel">
    <h3>ğŸ“Š í˜„ì¬ ì»¬ëŸ¼ ìƒíƒœ</h3>
    <pre id="columnState">{
  "leftPinned": ["id"],
  "center": ["name", "email", "department", "status", "salary", "joinDate", "extra1", "extra2", "extra3", "extra4", "extra5"],
  "rightPinned": []
}</pre>
  </div>
  
  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²•</h3>
    <pre><span class="comment">// ì»¬ëŸ¼ ì •ì˜ì—ì„œ ê³ ì • ì„¤ì •</span>
<span class="keyword">const</span> columns = [
  { key: <span class="string">'id'</span>, header: <span class="string">'ID'</span>, pinned: <span class="string">'left'</span> },
  { key: <span class="string">'name'</span>, header: <span class="string">'Name'</span> },
  { key: <span class="string">'email'</span>, header: <span class="string">'Email'</span> },
  { key: <span class="string">'actions'</span>, header: <span class="string">'Actions'</span>, pinned: <span class="string">'right'</span> },
];

<span class="comment">// ë™ì ìœ¼ë¡œ ì»¬ëŸ¼ ê³ ì •/í•´ì œ</span>
sheet.<span class="function">pinColumn</span>(<span class="string">'name'</span>, <span class="string">'left'</span>);   <span class="comment">// ì™¼ìª½ ê³ ì •</span>
sheet.<span class="function">pinColumn</span>(<span class="string">'status'</span>, <span class="string">'right'</span>); <span class="comment">// ì˜¤ë¥¸ìª½ ê³ ì •</span>
sheet.<span class="function">unpinColumn</span>(<span class="string">'name'</span>);            <span class="comment">// ê³ ì • í•´ì œ</span>

<span class="comment">// ì»¬ëŸ¼ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°</span>
<span class="keyword">const</span> state = sheet.<span class="function">getColumnState</span>();
<span class="comment">// [{ key: 'id', pinned: 'left', width: 60 }, ...]</span></pre>
  </div>
  
  <script type="module">
    // ë°ì´í„° ìƒì„± ì›Œì»¤
    const dataWorker = new Worker(
      new URL('../dataWorker.ts', import.meta.url),
      { type: 'module' }
    );
    
    function generateDataInWorker(count) {
      return new Promise((resolve) => {
        const handler = (event) => {
          const message = event.data;
          if (message.type === 'progress') {
            updateStatus(`ë°ì´í„° ìƒì„± ì¤‘... ${message.percent}%`);
          } else if (message.type === 'complete') {
            dataWorker.removeEventListener('message', handler);
            resolve({ data: message.data, time: message.time });
          }
        };
        dataWorker.addEventListener('message', handler);
        dataWorker.postMessage({ type: 'generate', count });
      });
    }
    
    let gridCore = null;
    let renderer = null;
    let columnState = {
      leftPinned: ['id'],
      center: ['name', 'email', 'department', 'status', 'salary', 'joinDate', 'extra1', 'extra2', 'extra3', 'extra4', 'extra5'],
      rightPinned: []
    };
    
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }
    
    function updateColumnStateDisplay() {
      document.getElementById('columnState').textContent = JSON.stringify(columnState, null, 2);
    }
    
    // ì „ì—­ í•¨ìˆ˜
    window.loadData = async function(count) {
      updateStatus(`${count.toLocaleString()}ê°œ ë°ì´í„° ìƒì„± ì¤‘...`);
      
      const { data, time: genTime } = await generateDataInWorker(count);
      
      updateStatus(`ë°ì´í„° ë¡œë“œ ì¤‘...`);
      
      if (gridCore) {
        const loadStart = performance.now();
        await gridCore.loadData(data);
        renderer.refresh();
        const loadTime = performance.now() - loadStart;
        
        updateStatus(
          `${count.toLocaleString()}ê°œ í–‰ ë¡œë“œ ì™„ë£Œ - ` +
          `ê°€ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ê³ ì • ì»¬ëŸ¼ì„ í™•ì¸í•˜ì„¸ìš”`
        );
      }
    };
    
    window.pinColumn = function(position) {
      const select = document.getElementById('columnSelect');
      const columnKey = select.value;
      
      // í˜„ì¬ ìœ„ì¹˜ì—ì„œ ì œê±°
      columnState.leftPinned = columnState.leftPinned.filter(k => k !== columnKey);
      columnState.center = columnState.center.filter(k => k !== columnKey);
      columnState.rightPinned = columnState.rightPinned.filter(k => k !== columnKey);
      
      // ìƒˆ ìœ„ì¹˜ì— ì¶”ê°€
      if (position === 'left') {
        columnState.leftPinned.push(columnKey);
      } else {
        columnState.rightPinned.push(columnKey);
      }
      
      updateColumnStateDisplay();
      updateStatus(`"${columnKey}" ì»¬ëŸ¼ì´ ${position === 'left' ? 'ì™¼ìª½' : 'ì˜¤ë¥¸ìª½'}ì— ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      
      // ì‹¤ì œ ë Œë”ëŸ¬ì— ê³ ì • ì ìš©
      if (renderer) {
        renderer.setColumnPinned(columnKey, position);
      }
    };
    
    window.unpinColumn = function() {
      const select = document.getElementById('columnSelect');
      const columnKey = select.value;
      
      // ê³ ì • í•´ì œ í›„ centerë¡œ ì´ë™
      const wasLeft = columnState.leftPinned.includes(columnKey);
      const wasRight = columnState.rightPinned.includes(columnKey);
      
      if (!wasLeft && !wasRight) {
        updateStatus(`"${columnKey}" ì»¬ëŸ¼ì€ ê³ ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`);
        return;
      }
      
      columnState.leftPinned = columnState.leftPinned.filter(k => k !== columnKey);
      columnState.rightPinned = columnState.rightPinned.filter(k => k !== columnKey);
      
      // center ë°°ì—´ì˜ ì ì ˆí•œ ìœ„ì¹˜ì— ì‚½ì…
      if (!columnState.center.includes(columnKey)) {
        columnState.center.push(columnKey);
      }
      
      updateColumnStateDisplay();
      updateStatus(`"${columnKey}" ì»¬ëŸ¼ ê³ ì •ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
      
      // ì‹¤ì œ ë Œë”ëŸ¬ì— ê³ ì • í•´ì œ ì ìš©
      if (renderer) {
        renderer.setColumnPinned(columnKey, 'none');
      }
    };
    
    window.resetColumns = function() {
      // ëª¨ë“  ì»¬ëŸ¼ì„ ê¸°ë³¸ ìƒíƒœë¡œ ë³µì›
      const allColumns = ['id', 'name', 'email', 'department', 'status', 'salary', 'joinDate', 'extra1', 'extra2', 'extra3', 'extra4', 'extra5'];
      
      // ëª¨ë“  ì»¬ëŸ¼ ê³ ì • í•´ì œ
      allColumns.forEach(key => {
        if (renderer) {
          renderer.setColumnPinned(key, 'none');
        }
      });
      
      // idë§Œ ì™¼ìª½ ê³ ì •
      if (renderer) {
        renderer.setColumnPinned('id', 'left');
      }
      
      columnState = {
        leftPinned: ['id'],
        center: ['name', 'email', 'department', 'status', 'salary', 'joinDate', 'extra1', 'extra2', 'extra3', 'extra4', 'extra5'],
        rightPinned: []
      };
      updateColumnStateDisplay();
      updateStatus('ì»¬ëŸ¼ ìƒíƒœê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    };
    
    // ì´ˆê¸°í™”
    async function init() {
      const container = document.getElementById('grid');
      
      const { GridCore, GridRenderer } = await import('../../src/index.ts');
      
      // ë§ì€ ì»¬ëŸ¼ìœ¼ë¡œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í…ŒìŠ¤íŠ¸
      const columns = [
        { key: 'id', header: 'ID', width: 60, pinned: 'left' },
        { key: 'name', header: 'Name', width: 150 },
        { key: 'email', header: 'Email', width: 250 },
        { key: 'department', header: 'Department', width: 120 },
        { key: 'status', header: 'Status', width: 100 },
        { key: 'salary', header: 'Salary', width: 120, formatter: (v) => '$' + v?.toLocaleString() },
        { key: 'joinDate', header: 'Join Date', width: 120 },
        // ì¶”ê°€ ì»¬ëŸ¼ (ê°€ë¡œ ìŠ¤í¬ë¡¤ í…ŒìŠ¤íŠ¸ìš©)
        { key: 'extra1', header: 'Extra 1', width: 100 },
        { key: 'extra2', header: 'Extra 2', width: 100 },
        { key: 'extra3', header: 'Extra 3', width: 100 },
        { key: 'extra4', header: 'Extra 4', width: 100 },
        { key: 'extra5', header: 'Extra 5', width: 100 },
      ];
      
      gridCore = new GridCore({ columns });
      await gridCore.initialize();
      
      renderer = new GridRenderer(container, {
        gridCore,
        options: {
          columns,
          rowHeight: 36,
          headerHeight: 40,
          resizableColumns: true,
          theme: 'light',
        },
        onRowClick: (rowIndex, row) => {
          console.log('Row clicked:', rowIndex, row);
        },
      });
      
      // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
      await window.loadData(1000);
    }
    
    init().catch(console.error);
  </script>
</body>
</html>
