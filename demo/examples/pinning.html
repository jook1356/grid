<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í–‰/ì»¬ëŸ¼ ê³ ì • (Row & Column Pinning) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
  <style>
    .preview-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 12px;
      display: flex;
      gap: 32px;
      flex-wrap: wrap;
    }
    .preview-section {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .preview-label {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 500;
    }
    .preview-items {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .preview-item {
      background: var(--bg);
      border: 1px dashed var(--border);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 11px;
      color: var(--text-muted);
    }
    .preview-item.top { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
    .preview-item.bottom { border-color: #2196F3; background: rgba(33, 150, 243, 0.1); }
    .preview-item.left { border-color: #FF9800; background: rgba(255, 152, 0, 0.1); }
    .preview-item.right { border-color: #9C27B0; background: rgba(156, 39, 176, 0.1); }
  </style>
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="pinning.html" class="active">ğŸ“Œ í–‰/ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
    <a href="selection-modes.html">ğŸ¯ ì„ íƒ ëª¨ë“œ</a>
    <a href="pivot.html">ğŸ“Š í”¼ë´‡ ê·¸ë¦¬ë“œ</a>
  </nav>
  
  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ“Œ í–‰/ì»¬ëŸ¼ ê³ ì • (Row & Column Pinning)</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>
  
  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>í–‰ ê³ ì •</strong>ì€ ìƒë‹¨/í•˜ë‹¨ì— ì§‘ê³„, í•„í„°, ì»¤ìŠ¤í…€ í–‰ì„ ê³ ì •í•©ë‹ˆë‹¤.
      <strong>ì»¬ëŸ¼ ê³ ì •</strong>ì€ ì™¼ìª½/ì˜¤ë¥¸ìª½ì— ì»¬ëŸ¼ì„ ê³ ì •í•©ë‹ˆë‹¤.
      <strong style="color: #4CAF50;">ì§‘ê³„ í–‰ì€ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì¬ê³„ì‚°ë©ë‹ˆë‹¤!</strong>
    </p>
  </div>
  
  <div class="demo-container">
    <!-- í˜„ì¬ ê³ ì • ìƒíƒœ ë¯¸ë¦¬ë³´ê¸° -->
    <div class="preview-panel">
      <div class="preview-section">
        <span class="preview-label">í–‰ ê³ ì •:</span>
        <div class="preview-items" id="pinnedPreview">
          <span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>
        </div>
      </div>
      <div class="preview-section">
        <span class="preview-label">ì»¬ëŸ¼ ê³ ì •:</span>
        <div class="preview-items" id="columnPreview">
          <span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>
        </div>
      </div>
    </div>

    <!-- ë°ì´í„° ë¡œë“œ íˆ´ë°” -->
    <div class="toolbar">
      <div class="toolbar-group">
        <label>ğŸ“Š ë°ì´í„° ë¡œë“œ:</label>
        <button onclick="loadData(1000)">1,000</button>
        <button onclick="loadData(10000)">10,000</button>
        <button onclick="loadData(100000)">100,000</button>
        <button onclick="loadData(1000000)">1,000,000</button>
        <button onclick="loadData(5000000)">5,000,000</button>
      </div>
      <div class="toolbar-divider"></div>
      <div class="toolbar-group">
        <button onclick="randomizeSalaries()" class="success">ê¸‰ì—¬ ëœë¤í™”</button>
        <button onclick="addRandomRow()">í–‰ ì¶”ê°€</button>
      </div>
    </div>

    <!-- í–‰ ê³ ì • íˆ´ë°” -->
    <div class="toolbar">
      <div class="toolbar-group">
        <label>â¬†ï¸ ìƒë‹¨ í–‰:</label>
        <select id="topRowType">
          <option value="sum">í•©ê³„</option>
          <option value="avg">í‰ê· </option>
          <option value="count">ê°œìˆ˜</option>
          <option value="filter">í•„í„°</option>
          <option value="custom">ì»¤ìŠ¤í…€</option>
        </select>
        <button onclick="addTopRow()" class="success">ì¶”ê°€</button>
        <button onclick="clearTop()" class="secondary">ì œê±°</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>â¬‡ï¸ í•˜ë‹¨ í–‰:</label>
        <select id="bottomRowType">
          <option value="sum" selected>í•©ê³„</option>
          <option value="avg">í‰ê· </option>
          <option value="count">ê°œìˆ˜</option>
          <option value="grandtotal">ì´í•©ê³„</option>
          <option value="custom">ì»¤ìŠ¤í…€</option>
        </select>
        <button onclick="addBottomRow()" class="success">ì¶”ê°€</button>
        <button onclick="clearBottom()" class="secondary">ì œê±°</button>
      </div>
    </div>

    <!-- ì»¬ëŸ¼ ê³ ì • íˆ´ë°” -->
    <div class="toolbar">
      <div class="toolbar-group">
        <label>ğŸ“Œ ì»¬ëŸ¼:</label>
        <select id="columnSelect">
          <option value="id">ID</option>
          <option value="name">Name</option>
          <option value="department">Department</option>
          <option value="salary">Salary</option>
          <option value="bonus">Bonus</option>
          <option value="performance">Performance</option>
        </select>
        <button onclick="pinColumnLeft()" class="success">â† ì™¼ìª½ ê³ ì •</button>
        <button onclick="pinColumnRight()" class="success">ì˜¤ë¥¸ìª½ ê³ ì • â†’</button>
        <button onclick="unpinColumn()" class="secondary">ê³ ì • í•´ì œ</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <button onclick="resetAll()" class="warning">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </div>
    
    <div id="grid"></div>
    
    <div class="status-bar" id="status">
      ì¤€ë¹„ë¨ - í–‰ê³¼ ì»¬ëŸ¼ì„ ê³ ì •í•´ë³´ì„¸ìš”
    </div>
  </div>
  
  <!-- í˜„ì¬ ìƒíƒœ -->
  <div class="info-panel">
    <h3>ğŸ“Š í˜„ì¬ ê³ ì • ìƒíƒœ</h3>
    <pre id="pinState">{
  "rows": { "top": [], "bottom": ["sum"] },
  "columns": { "left": ["id"], "right": [] }
}</pre>
  </div>
  
  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²•</h3>
    <pre><span class="keyword">import</span> { Row } <span class="keyword">from</span> <span class="string">'puresheet'</span>;

<span class="comment">// íŒ©í† ë¦¬ ë©”ì„œë“œë¡œ ì´í•©ê³„ í–‰ ìƒì„± (ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ì¬ê³„ì‚°!)</span>
<span class="keyword">const</span> totalRow = Row.<span class="function">createGrandTotalRow</span>([
  { columnKey: <span class="string">'salary'</span>, func: <span class="string">'sum'</span>, formatter: v => <span class="string">'$'</span> + v.toLocaleString() },
  { columnKey: <span class="string">'bonus'</span>, func: <span class="string">'sum'</span> },
  { columnKey: <span class="string">'performance'</span>, func: <span class="string">'avg'</span> },
], { labelColumn: <span class="string">'name'</span>, label: <span class="string">'ì´í•©ê³„'</span> });

<span class="comment">// ì†Œê³„ í–‰ ìƒì„±</span>
<span class="keyword">const</span> subtotalRow = Row.<span class="function">createSubtotalRow</span>([
  { columnKey: <span class="string">'salary'</span>, func: <span class="string">'avg'</span> },
], { pinned: <span class="string">'top'</span> });

<span class="comment">// PureSheetì—ì„œ ì§ì ‘ ê³ ì • í–‰ ì¶”ê°€</span>
pureSheet.<span class="function">pinRowBottom</span>(totalRow);

<span class="comment">// ë°ì´í„° ë³€ê²½ í›„ refresh() í˜¸ì¶œí•˜ë©´ ì§‘ê³„ ê°’ ìë™ ì—…ë°ì´íŠ¸</span>
<span class="keyword">await</span> pureSheet.<span class="function">loadData</span>(newData);
pureSheet.<span class="function">refresh</span>();  <span class="comment">// ì§‘ê³„ í–‰ë„ ìë™ ì¬ê³„ì‚°!</span></pre>
  </div>
  
  <script type="module">
    const { PureSheet, Row } = await import('../../src/index.ts');
    
    let renderer = null;
    let pinnedRowCounter = 0;
    
    // ë°ì´í„° ìƒì„± ì›¹ ì›Œì»¤ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëŒ€ëŸ‰ ë°ì´í„° ìƒì„±)
    const dataWorker = new Worker(
      new URL('../dataWorker.ts', import.meta.url),
      { type: 'module' }
    );
    
    // ì›Œì»¤ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ (Promiseë¡œ ë˜í•‘)
    function generateDataInWorker(count) {
      return new Promise((resolve) => {
        const handler = (event) => {
          const message = event.data;
          
          if (message.type === 'progress') {
            updateStatus(`${count.toLocaleString()}ê°œ ë°ì´í„° ìƒì„± ì¤‘... ${message.percent}%`);
          } else if (message.type === 'complete') {
            dataWorker.removeEventListener('message', handler);
            resolve({ data: message.data, time: message.time });
          }
        };
        
        dataWorker.addEventListener('message', handler);
        dataWorker.postMessage({ type: 'generate', count });
      });
    }
    
    // ìƒíƒœ ì¶”ì 
    let columnPinState = {
      leftPinned: ['id'],
      center: ['name', 'department', 'salary', 'bonus', 'performance'],
      rightPinned: []
    };
    
    const columnHeaders = {
      id: 'ID', name: 'Name', department: 'Department',
      salary: 'Salary', bonus: 'Bonus', performance: 'Performance'
    };
    
    function updateStatus(msg) {
      document.getElementById('status').textContent = msg;
    }
    
    function updatePinStateDisplay() {
      const { top, bottom } = renderer ? renderer.getPinnedRows() : { top: [], bottom: [] };
      
      const state = {
        rows: {
          top: top.map(r => r.variant),
          bottom: bottom.map(r => r.variant)
        },
        columns: {
          left: columnPinState.leftPinned,
          right: columnPinState.rightPinned
        }
      };
      document.getElementById('pinState').textContent = JSON.stringify(state, null, 2);
    }
    
    function updatePinnedPreview() {
      if (!renderer) return;
      
      const { top, bottom } = renderer.getPinnedRows();
      const preview = document.getElementById('pinnedPreview');
      
      if (top.length === 0 && bottom.length === 0) {
        preview.innerHTML = '<span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>';
      } else {
        let html = '';
        top.forEach(row => { html += `<span class="preview-item top">â¬†ï¸ ${row.variant}</span>`; });
        bottom.forEach(row => { html += `<span class="preview-item bottom">â¬‡ï¸ ${row.variant}</span>`; });
        preview.innerHTML = html;
      }
      updatePinStateDisplay();
    }
    
    function updateColumnPreview() {
      const preview = document.getElementById('columnPreview');
      if (columnPinState.leftPinned.length === 0 && columnPinState.rightPinned.length === 0) {
        preview.innerHTML = '<span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>';
      } else {
        let html = '';
        columnPinState.leftPinned.forEach(k => { html += `<span class="preview-item left">â¬…ï¸ ${columnHeaders[k]}</span>`; });
        columnPinState.rightPinned.forEach(k => { html += `<span class="preview-item right">â¡ï¸ ${columnHeaders[k]}</span>`; });
        preview.innerHTML = html;
      }
      updatePinStateDisplay();
    }
    
    // í–‰ ìƒì„± í•¨ìˆ˜ë“¤ - ìƒˆë¡œìš´ íŒ©í† ë¦¬ ë©”ì„œë“œ ì‚¬ìš© (ìë™ ì¬ê³„ì‚°!)
    function createAggregateRow(type, position) {
      const id = `${type}-${position}-${++pinnedRowCounter}`;
      
      // ì§‘ê³„ ì„¤ì • - ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ì¬ê³„ì‚°ë¨
      const aggregates = [
        { 
          columnKey: 'salary', 
          func: type === 'count' ? 'count' : type === 'grandtotal' ? 'sum' : type,
          formatter: v => '$' + (v?.toLocaleString() || '0')
        },
        { 
          columnKey: 'bonus', 
          func: type === 'count' ? 'count' : type === 'grandtotal' ? 'sum' : type,
          formatter: v => '$' + (v?.toLocaleString() || '0')
        },
        { 
          columnKey: 'performance', 
          func: type === 'count' ? 'count' : type === 'sum' || type === 'grandtotal' ? 'sum' : 'avg',
          formatter: v => (v?.toFixed?.(1) || v) + '%'
        },
      ];
      
      const label = type === 'sum' ? 'í•©ê³„' : type === 'avg' ? 'í‰ê· ' : type === 'count' ? 'ê°œìˆ˜' : 'ì´í•©ê³„';
      
      // íŒ©í† ë¦¬ ë©”ì„œë“œ ì‚¬ìš© (ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ì¬ê³„ì‚°!)
      if (type === 'grandtotal') {
        return Row.createGrandTotalRow(aggregates, { 
          id, 
          pinned: position,
          labelColumn: 'name',
          label: 'ì´í•©ê³„'
        });
      } else {
        return Row.createSubtotalRow(aggregates, { 
          id, 
          pinned: position,
          labelColumn: 'name',
          label
        });
      }
    }
    
    function createFilterRow(position) {
      return new Row({
        id: `filter-${position}-${++pinnedRowCounter}`,
        structural: true,
        variant: 'filter',
        pinned: position,
        render: (container, ctx) => {
          let left = container.querySelector('.ps-cells-left');
          let center = container.querySelector('.ps-cells-center');
          let right = container.querySelector('.ps-cells-right');
          if (!center) {
            container.innerHTML = '<div class="ps-cells-left"></div><div class="ps-cells-center"></div><div class="ps-cells-right"></div>';
            left = container.querySelector('.ps-cells-left');
            center = container.querySelector('.ps-cells-center');
            right = container.querySelector('.ps-cells-right');
          }
          const makeInputs = cols => cols.filter(c => c.visible).map(c => `
            <div class="ps-cell" style="width:${c.width}px;min-width:${c.width}px;">
              <input type="text" placeholder="Filter..." style="width:100%;padding:4px 6px;border:1px solid #ddd;border-radius:3px;font-size:11px;">
            </div>
          `).join('');
          left.innerHTML = makeInputs(ctx.columnGroups.left);
          center.innerHTML = makeInputs(ctx.columnGroups.center);
          right.innerHTML = makeInputs(ctx.columnGroups.right);
          [left, center, right].forEach(c => { c.style.display = 'flex'; c.style.alignItems = 'center'; });
        },
      });
    }
    
    function createCustomRow(position) {
      return new Row({
        id: `custom-${position}-${++pinnedRowCounter}`,
        structural: true,
        variant: 'custom',
        pinned: position,
        render: (container, ctx) => {
          let left = container.querySelector('.ps-cells-left');
          let center = container.querySelector('.ps-cells-center');
          let right = container.querySelector('.ps-cells-right');
          if (!center) {
            container.innerHTML = '<div class="ps-cells-left"></div><div class="ps-cells-center"></div><div class="ps-cells-right"></div>';
            left = container.querySelector('.ps-cells-left');
            center = container.querySelector('.ps-cells-center');
            right = container.querySelector('.ps-cells-right');
          }
          const lw = ctx.columnGroups.left.reduce((s, c) => s + (c.visible ? c.width : 0), 0);
          const rw = ctx.columnGroups.right.reduce((s, c) => s + (c.visible ? c.width : 0), 0);
          const gradient = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
          left.innerHTML = lw > 0 ? `<div style="width:${lw}px;height:100%;display:flex;align-items:center;justify-content:center;background:${gradient};color:white;">ğŸ“Œ</div>` : '';
          center.innerHTML = `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:${gradient};color:white;font-weight:600;font-size:13px;gap:8px;"><span>âœ¨</span><span>ì»¤ìŠ¤í…€ í–‰</span><span>âœ¨</span></div>`;
          right.innerHTML = rw > 0 ? `<div style="width:${rw}px;height:100%;display:flex;align-items:center;justify-content:center;background:${gradient};color:white;">ğŸ“Œ</div>` : '';
          [left, center, right].forEach(c => { c.style.display = 'flex'; });
          center.style.padding = '4px';
        },
      });
    }
    
    // ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ (ì›¹ ì›Œì»¤ ì‚¬ìš©)
    window.loadData = async function(count) {
      if (!renderer) return;
      
      updateStatus(`${count.toLocaleString()}ê°œ ë°ì´í„° ìƒì„± ì¤‘...`);
      
      // ì›¹ ì›Œì»¤ì—ì„œ ë°ì´í„° ìƒì„± (UI ë¸”ë¡œí‚¹ ì—†ìŒ)
      const { data, time: genTime } = await generateDataInWorker(count);
      
      updateStatus(`ë°ì´í„° ë¡œë“œ ì¤‘...`);
      
      const loadStart = performance.now();
      await renderer.loadData(data);
      const loadTime = performance.now() - loadStart;
      
      updateStatus(`${count.toLocaleString()}ê°œ í–‰ ë¡œë“œ ì™„ë£Œ (ìƒì„±: ${genTime.toFixed(0)}ms, ë¡œë“œ: ${loadTime.toFixed(0)}ms)`);
    };
    
    // í–‰ ê³ ì • í•¨ìˆ˜
    window.addTopRow = function() {
      if (!renderer) return;
      const type = document.getElementById('topRowType').value;
      const row = type === 'filter' ? createFilterRow('top') : type === 'custom' ? createCustomRow('top') : createAggregateRow(type, 'top');
      renderer.pinRowTop(row);
      updatePinnedPreview();
      updateStatus(`ìƒë‹¨ì— ${type} í–‰ ì¶”ê°€ë¨`);
    };
    
    window.addBottomRow = function() {
      if (!renderer) return;
      const type = document.getElementById('bottomRowType').value;
      const row = type === 'custom' ? createCustomRow('bottom') : createAggregateRow(type, 'bottom');
      renderer.pinRowBottom(row);
      updatePinnedPreview();
      updateStatus(`í•˜ë‹¨ì— ${type} í–‰ ì¶”ê°€ë¨`);
    };
    
    window.clearTop = function() {
      if (!renderer) return;
      renderer.getPinnedRows().top.forEach(r => renderer.unpinRow(r.id));
      updatePinnedPreview();
      updateStatus('ìƒë‹¨ ê³ ì • í–‰ ì œê±°ë¨');
    };
    
    window.clearBottom = function() {
      if (!renderer) return;
      renderer.getPinnedRows().bottom.forEach(r => renderer.unpinRow(r.id));
      updatePinnedPreview();
      updateStatus('í•˜ë‹¨ ê³ ì • í–‰ ì œê±°ë¨');
    };
    
    // ì»¬ëŸ¼ ê³ ì • í•¨ìˆ˜
    window.pinColumnLeft = function() {
      const key = document.getElementById('columnSelect').value;
      columnPinState.leftPinned = columnPinState.leftPinned.filter(k => k !== key);
      columnPinState.center = columnPinState.center.filter(k => k !== key);
      columnPinState.rightPinned = columnPinState.rightPinned.filter(k => k !== key);
      columnPinState.leftPinned.push(key);
      renderer?.pinColumnLeft(key);
      updateColumnPreview();
      updateStatus(`"${columnHeaders[key]}" ì™¼ìª½ ê³ ì •ë¨`);
    };
    
    window.pinColumnRight = function() {
      const key = document.getElementById('columnSelect').value;
      columnPinState.leftPinned = columnPinState.leftPinned.filter(k => k !== key);
      columnPinState.center = columnPinState.center.filter(k => k !== key);
      columnPinState.rightPinned = columnPinState.rightPinned.filter(k => k !== key);
      columnPinState.rightPinned.push(key);
      renderer?.pinColumnRight(key);
      updateColumnPreview();
      updateStatus(`"${columnHeaders[key]}" ì˜¤ë¥¸ìª½ ê³ ì •ë¨`);
    };
    
    window.unpinColumn = function() {
      const key = document.getElementById('columnSelect').value;
      if (!columnPinState.leftPinned.includes(key) && !columnPinState.rightPinned.includes(key)) {
        updateStatus(`"${columnHeaders[key]}" ì»¬ëŸ¼ì€ ê³ ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤`);
        return;
      }
      columnPinState.leftPinned = columnPinState.leftPinned.filter(k => k !== key);
      columnPinState.rightPinned = columnPinState.rightPinned.filter(k => k !== key);
      if (!columnPinState.center.includes(key)) columnPinState.center.push(key);
      renderer?.unpinColumn(key);
      updateColumnPreview();
      updateStatus(`"${columnHeaders[key]}" ê³ ì • í•´ì œë¨`);
    };
    
    window.resetAll = function() {
      if (renderer) renderer.clearPinnedRows();
      
      const allCols = ['id', 'name', 'department', 'salary', 'bonus', 'performance'];
      allCols.forEach(k => renderer?.unpinColumn(k));
      columnPinState = { leftPinned: [], center: allCols, rightPinned: [] };
      
      updatePinnedPreview();
      updateColumnPreview();
      updateStatus('ëª¨ë“  ê³ ì • ìƒíƒœ ì´ˆê¸°í™”ë¨');
    };
    
    // ë°ì´í„° ìˆ˜ì • í•¨ìˆ˜ë“¤ (ì§‘ê³„ ìë™ ì¬ê³„ì‚° í…ŒìŠ¤íŠ¸ìš©)
    window.randomizeSalaries = async function() {
      if (!renderer) return;
      // ëª¨ë“  ê¸‰ì—¬ë¥¼ ëœë¤í•˜ê²Œ ë³€ê²½
      const currentData = [...renderer.getAllData()];
      const newData = currentData.map(row => ({
        ...row,
        salary: 30000 + Math.floor(Math.random() * 70000),
        bonus: 500 + Math.floor(Math.random() * 15000),
      }));
      
      await renderer.loadData(newData);
      
      updateStatus('ê¸‰ì—¬ ëœë¤í™” ì™„ë£Œ - ì§‘ê³„ ê°’ ìë™ ì—…ë°ì´íŠ¸ë¨!');
    };
    
    window.addRandomRow = async function() {
      if (!renderer) return;
      const currentData = [...renderer.getAllData()];
      const newId = currentData.length + 1;
      const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„'];
      const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'];
      const newRow = {
        id: newId,
        name: names[Math.floor(Math.random() * names.length)] + newId,
        department: departments[Math.floor(Math.random() * departments.length)],
        salary: 40000 + Math.floor(Math.random() * 60000),
        bonus: 1000 + Math.floor(Math.random() * 9000),
        performance: Math.floor(Math.random() * 100),
      };
      
      currentData.push(newRow);
      await renderer.loadData(currentData);
      
      updateStatus(`í–‰ ì¶”ê°€ë¨ (ID: ${newId}) - ì§‘ê³„ ê°’ ìë™ ì—…ë°ì´íŠ¸!`);
    };
    
    // ì´ˆê¸°í™”
    async function init() {
      const container = document.getElementById('grid');
      
      const columns = [
        { key: 'id', header: 'ID', width: 60, pinned: 'left' },
        { key: 'name', header: 'Name', width: 150 },
        { key: 'department', header: 'Department', width: 120 },
        { key: 'salary', header: 'Salary', width: 120, formatter: v => '$' + (v?.toLocaleString() || '0') },
        { key: 'bonus', header: 'Bonus', width: 100, formatter: v => '$' + (v?.toLocaleString() || '0') },
        { key: 'performance', header: 'Performance', width: 100, formatter: v => v + '%' },
      ];
      
      // PureSheet ì‚¬ìš© (SelectionManager í¬í•¨)
      renderer = new PureSheet(container, {
        columns, 
        rowHeight: 36, 
        headerHeight: 40, 
        resizableColumns: true, 
        reorderableColumns: true,
        selectionMode: 'all',
        multiSelect: true,
        theme: 'light' 
      });
      
      // ì´ˆê¸° ë°ì´í„° ë¡œë“œ (1,000ê°œ)
      await loadData(1000);
      
      // ê¸°ë³¸ í•˜ë‹¨ í•©ê³„ í–‰ ì¶”ê°€
      renderer.pinRowBottom(createAggregateRow('sum', 'bottom'));
      
      updatePinnedPreview();
      updateColumnPreview();
    }
    
    init().catch(console.error);
  </script>
</body>
</html>

