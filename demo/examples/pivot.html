<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í”¼ë²— ê·¸ë¦¬ë“œ (Pivot Grid) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="pinning.html">ğŸ“Œ í–‰/ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
    <a href="merge.html">ğŸ”— ì…€ ë³‘í•©</a>
    <a href="selection-modes.html">ğŸ¯ ì„ íƒ ëª¨ë“œ</a>
    <a href="pivot.html" class="active">ğŸ“Š í”¼ë²—</a>
  </nav>
  
  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ“Š í”¼ë²— ê·¸ë¦¬ë“œ (Pivot Grid)</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>
  
  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>í”¼ë²— ê·¸ë¦¬ë“œ</strong>ëŠ” ë°ì´í„°ë¥¼ í–‰ ì°¨ì›ê³¼ ì—´ ì°¨ì›ìœ¼ë¡œ êµì°¨ ì§‘ê³„í•˜ì—¬ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.
      ì•„ë˜ ì˜ˆì œì—ì„œëŠ” ì œí’ˆë³„(í–‰)ë¡œ ì›”ë³„(ì—´) íŒë§¤ëŸ‰ê³¼ ìˆ˜ìµì„ ì§‘ê³„í•©ë‹ˆë‹¤.
      ë‹¤ì¤‘ ë ˆë²¨ ì»¬ëŸ¼ í—¤ë”ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
    </p>
  </div>
  
  <div class="demo-container">
    <div class="toolbar">
      <div class="toolbar-group">
        <label>ë°ì´í„° ìˆ˜:</label>
        <select id="dataCountSelect" onchange="regenerateData()">
          <option value="120">120ê±´</option>
          <option value="1000">1,000ê±´</option>
          <option value="10000">1ë§Œê±´</option>
          <option value="100000" selected>10ë§Œê±´</option>
          <option value="500000">50ë§Œê±´</option>
          <option value="1000000">100ë§Œê±´</option>
          <option value="2000000">200ë§Œê±´</option>
          <option value="5000000">500ë§Œê±´</option>
        </select>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>í–‰ ì¶•:</label>
        <select id="rowFieldSelect" onchange="updatePivot()">
          <option value="product" selected>ì œí’ˆ</option>
          <option value="region">ì§€ì—­</option>
          <option value="product,region">ì œí’ˆ â†’ ì§€ì—­</option>
        </select>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>ì—´ ì¶•:</label>
        <select id="columnFieldSelect" onchange="updatePivot()">
          <option value="month" selected>ì›”</option>
          <option value="quarter">ë¶„ê¸°</option>
          <option value="quarter,month">ë¶„ê¸° â†’ ì›”</option>
        </select>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>ê°’:</label>
        <select id="valueFieldSelect" onchange="updatePivot()">
          <option value="sales" selected>íŒë§¤ëŸ‰</option>
          <option value="profit">ìˆ˜ìµ</option>
          <option value="sales,profit">íŒë§¤ëŸ‰ + ìˆ˜ìµ</option>
        </select>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <button onclick="resetPivot()">ğŸ”„ ì´ˆê¸°í™”</button>
      </div>
    </div>
    
    <div id="grid" style="height: 500px;"></div>
    
    <div class="status-bar" id="status">
      ì´ˆê¸°í™” ì¤‘...
    </div>
  </div>
  
  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²• (Pivot ëª¨ë“œ)</h3>
    <pre><span class="comment">// í”¼ë²— ëª¨ë“œë¡œ PureSheet ìƒì„±</span>
<span class="keyword">const</span> pivotGrid = <span class="keyword">new</span> <span class="function">PureSheet</span>(container, {
  mode: <span class="string">'pivot'</span>,
  
  data: salesData,
  
  <span class="comment">// í•„ë“œ ì •ì˜</span>
  fields: [
    { key: <span class="string">'month'</span>, header: <span class="string">'ì›”'</span>, dataType: <span class="string">'string'</span> },
    { key: <span class="string">'product'</span>, header: <span class="string">'ì œí’ˆ'</span>, dataType: <span class="string">'string'</span> },
    { key: <span class="string">'sales'</span>, header: <span class="string">'íŒë§¤ëŸ‰'</span>, dataType: <span class="string">'number'</span>, aggregate: <span class="string">'sum'</span> },
    { key: <span class="string">'profit'</span>, header: <span class="string">'ìˆ˜ìµ'</span>, dataType: <span class="string">'number'</span>, aggregate: <span class="string">'sum'</span> },
  ],
  
  <span class="comment">// í”¼ë²— ì¶• ì„¤ì •</span>
  rowFields: [<span class="string">'product'</span>],           <span class="comment">// í–‰ ì¶•</span>
  columnFields: [<span class="string">'month'</span>],          <span class="comment">// ì—´ ì¶• (í”¼ë²—ë˜ëŠ” í•„ë“œ)</span>
  valueFields: [<span class="string">'sales'</span>, <span class="string">'profit'</span>], <span class="comment">// ê°’ í•„ë“œ</span>
  
  theme: <span class="string">'light'</span>,
});

<span class="comment">// ë™ì ìœ¼ë¡œ í”¼ë²— ì„¤ì • ë³€ê²½</span>
pivotGrid.<span class="function">setPivotConfig</span>({
  rowFields: [<span class="string">'region'</span>],
  columnFields: [<span class="string">'quarter'</span>],
  valueFields: [<span class="string">'sales'</span>],
});</pre>
  </div>
  
  <!-- ë°ì´í„° ì •ë³´ -->
  <div class="info-panel">
    <h3>ğŸ“‹ ìƒ˜í”Œ ë°ì´í„° êµ¬ì¡°</h3>
    <div class="data-preview">
      <table>
        <thead>
          <tr>
            <th>month</th>
            <th>quarter</th>
            <th>product</th>
            <th>region</th>
            <th>sales</th>
            <th>profit</th>
          </tr>
        </thead>
        <tbody id="dataPreview">
          <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
        </tbody>
      </table>
    </div>
  </div>
  
  <script type="module">
    import { PureSheet } from '../../src/index.ts';
    
    let sheet = null;
    let sampleData = [];
    
    // ê¸°ë³¸ ë°ì´í„° ë°°ì—´
    const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
    const quarters = ['Q1', 'Q1', 'Q1', 'Q2', 'Q2', 'Q2', 'Q3', 'Q3', 'Q3', 'Q4', 'Q4', 'Q4'];
    const products = ['ë…¸íŠ¸ë¶', 'ìŠ¤ë§ˆíŠ¸í°', 'íƒœë¸”ë¦¿', 'ëª¨ë‹ˆí„°', 'í‚¤ë³´ë“œ', 'ë§ˆìš°ìŠ¤', 'í—¤ë“œí°', 'ìŠ¤í”¼ì»¤', 'ì›¹ìº ', 'í”„ë¦°í„°'];
    const regions = ['ì„œìš¸', 'ë¶€ì‚°', 'ëŒ€êµ¬', 'ì¸ì²œ', 'ê´‘ì£¼', 'ëŒ€ì „', 'ìš¸ì‚°', 'ì„¸ì¢…'];
    
    // ë°ì´í„° ìƒì„± í•¨ìˆ˜
    function generateData(targetCount) {
      const startTime = performance.now();
      updateStatus(`ë°ì´í„° ìƒì„± ì¤‘... (ëª©í‘œ: ${targetCount.toLocaleString()}ê±´)`);
      
      const data = [];
      let id = 1;
      
      // ê¸°ë³¸ ì¡°í•© ìˆ˜: products Ã— regions Ã— months = 10 Ã— 8 Ã— 12 = 960
      const baseComboCount = products.length * regions.length * months.length;
      
      // í•„ìš”í•œ ë°˜ë³µ ìˆ˜ ê³„ì‚°
      const iterations = Math.ceil(targetCount / baseComboCount);
      
      for (let iter = 0; iter < iterations && data.length < targetCount; iter++) {
        for (const product of products) {
          if (data.length >= targetCount) break;
          for (const region of regions) {
            if (data.length >= targetCount) break;
            for (let i = 0; i < months.length; i++) {
              if (data.length >= targetCount) break;
              
              const baseSales = Math.floor(Math.random() * 100) + 50;
              const baseProfit = Math.floor(baseSales * (Math.random() * 0.3 + 0.1));
              
              data.push({
                id: id++,
                month: months[i],
                quarter: quarters[i],
                product,
                region,
                sales: baseSales,
                profit: baseProfit,
              });
            }
          }
        }
      }
      
      const duration = performance.now() - startTime;
      console.log(`ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length.toLocaleString()}ê±´ (${duration.toFixed(0)}ms)`);
      
      return data;
    }
    
    // ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
    function showDataPreview() {
      const tbody = document.getElementById('dataPreview');
      tbody.innerHTML = sampleData.slice(0, 5).map(row => `
        <tr>
          <td>${row.month}</td>
          <td>${row.quarter}</td>
          <td>${row.product}</td>
          <td>${row.region}</td>
          <td>${row.sales}</td>
          <td>${row.profit}</td>
        </tr>
      `).join('') + '<tr><td colspan="6">... (ì´ ' + sampleData.length.toLocaleString() + 'í–‰)</td></tr>';
    }
    
    // ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }
    
    // í”¼ë²— ì„¤ì • íŒŒì‹±
    function parsePivotConfig() {
      const rowFieldSelect = document.getElementById('rowFieldSelect');
      const columnFieldSelect = document.getElementById('columnFieldSelect');
      const valueFieldSelect = document.getElementById('valueFieldSelect');
      
      return {
        rowFields: rowFieldSelect.value.split(','),
        columnFields: columnFieldSelect.value.split(','),
        valueFields: valueFieldSelect.value.split(',').map(field => ({
          field,
          aggregate: 'sum',
          header: field === 'sales' ? 'íŒë§¤ëŸ‰' : 'ìˆ˜ìµ',
        })),
      };
    }
    
    // í”¼ë²— ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
    async function initPivotGrid() {
      const container = document.getElementById('grid');
      
      // ì´ˆê¸° ë°ì´í„° ìƒì„±
      const dataCount = parseInt(document.getElementById('dataCountSelect').value);
      sampleData = generateData(dataCount);
      showDataPreview();
      
      const fields = [
        { key: 'month', header: 'ì›”', dataType: 'string' },
        { key: 'quarter', header: 'ë¶„ê¸°', dataType: 'string' },
        { key: 'product', header: 'ì œí’ˆ', dataType: 'string' },
        { key: 'region', header: 'ì§€ì—­', dataType: 'string' },
        { key: 'sales', header: 'íŒë§¤ëŸ‰', dataType: 'number', aggregate: 'sum' },
        { key: 'profit', header: 'ìˆ˜ìµ', dataType: 'number', aggregate: 'sum' },
      ];
      
      const pivotConfig = parsePivotConfig();
      
      sheet = new PureSheet(container, {
        mode: 'pivot',
        fields,
        rowFields: pivotConfig.rowFields,
        columnFields: pivotConfig.columnFields,
        valueFields: pivotConfig.valueFields.map(v => v.field),
        rowStyle: 'height: 36px;',
        headerStyle: 'height: 40px;',
        theme: 'light',
      });
      
      // ë°ì´í„° ë¨¼ì € ë¡œë“œ (í”¼ë²— ì—°ì‚° ì „ì— ë°ì´í„°ê°€ í•„ìš”)
      await sheet.loadData(sampleData);
      
      // ë°ì´í„° ë¡œë“œ í›„ í”¼ë²— ì„¤ì • ì ìš©
      await sheet.setPivotConfig(pivotConfig);
      
      updateStatus(`í”¼ë²— ì™„ë£Œ - ${sampleData.length.toLocaleString()}ê°œ ì›ë³¸ ë°ì´í„° â†’ ${sheet.getVisibleRowCount()}ê°œ í”¼ë²— í–‰`);
    }
    
    // ë°ì´í„° ì¬ìƒì„±
    window.regenerateData = async function() {
      if (!sheet) return;
      
      const dataCount = parseInt(document.getElementById('dataCountSelect').value);
      
      // ëŒ€ìš©ëŸ‰ ë°ì´í„° ê²½ê³ 
      if (dataCount >= 1000000) {
        updateStatus(`âš ï¸ ${(dataCount / 1000000).toFixed(0)}ë°±ë§Œê±´ ë°ì´í„° ìƒì„± ì¤‘... ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);
        // UI ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì§§ì€ ì§€ì—°
        await new Promise(resolve => setTimeout(resolve, 50));
      }
      
      const startTime = performance.now();
      
      sampleData = generateData(dataCount);
      showDataPreview();
      
      const genTime = performance.now() - startTime;
      updateStatus(`ë°ì´í„° ìƒì„± ì™„ë£Œ (${genTime.toFixed(0)}ms) - í”¼ë²— ê³„ì‚° ì¤‘...`);
      
      // UI ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì§§ì€ ì§€ì—°
      await new Promise(resolve => setTimeout(resolve, 50));
      
      const pivotStart = performance.now();
      await sheet.loadData(sampleData);
      
      const pivotConfig = parsePivotConfig();
      await sheet.setPivotConfig(pivotConfig);
      
      const pivotTime = performance.now() - pivotStart;
      const totalTime = performance.now() - startTime;
      
      updateStatus(`ì™„ë£Œ - ${sampleData.length.toLocaleString()}ê±´ â†’ ${sheet.getVisibleRowCount()}í–‰ (ìƒì„±: ${genTime.toFixed(0)}ms, í”¼ë²—: ${pivotTime.toFixed(0)}ms, ì´: ${totalTime.toFixed(0)}ms)`);
    };
    
    // í”¼ë²— ì—…ë°ì´íŠ¸
    window.updatePivot = async function() {
      if (!sheet) return;
      
      const pivotConfig = parsePivotConfig();
      updateStatus('í”¼ë²— ê³„ì‚° ì¤‘...');
      
      try {
        await sheet.setPivotConfig(pivotConfig);
        updateStatus(`í”¼ë²— ì™„ë£Œ - í–‰: ${pivotConfig.rowFields.join(' â†’ ')}, ì—´: ${pivotConfig.columnFields.join(' â†’ ')}`);
      } catch (error) {
        console.error('Pivot error:', error);
        updateStatus('í”¼ë²— ì˜¤ë¥˜: ' + error.message);
      }
    };
    
    // ì´ˆê¸°í™”
    window.resetPivot = async function() {
      document.getElementById('rowFieldSelect').value = 'product';
      document.getElementById('columnFieldSelect').value = 'month';
      document.getElementById('valueFieldSelect').value = 'sales';
      await updatePivot();
    };
    
    // ì´ˆê¸°í™”
    initPivotGrid().catch(console.error);
  </script>
  
  <style>
    .info-panel {
      margin: 20px auto;
      max-width: 1200px;
      padding: 15px 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    .info-panel h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #495057;
    }
    
    .data-preview {
      overflow-x: auto;
    }
    
    .data-preview table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    
    .data-preview th,
    .data-preview td {
      padding: 6px 10px;
      border: 1px solid #dee2e6;
      text-align: left;
    }
    
    .data-preview th {
      background: #e9ecef;
      font-weight: 600;
    }
    
    .data-preview tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .data-preview tr:last-child td {
      text-align: center;
      color: #6c757d;
      font-style: italic;
    }
  </style>
</body>
</html>

