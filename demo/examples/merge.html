<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì…€ ë³‘í•© (Cell Merging) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
</head>

<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="pinning.html">ğŸ“Œ í–‰/ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
    <a href="merge.html" class="active">ğŸ”— ì…€ ë³‘í•©</a>
    <a href="selection-modes.html">ğŸ¯ ì„ íƒ ëª¨ë“œ</a>
    <a href="pivot.html">ğŸ“Š í”¼ë²—</a>
    <a href="format-row.html">ğŸ¨ formatRow</a>
    <a href="crud.html">âœï¸ CRUD</a>
    <a href="column-visibility.html">ğŸ‘ï¸ í•„ë“œ ì„ íƒ</a>
  </nav>

  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ”— ì…€ ë³‘í•© (Cell Merging)</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>

  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>ì…€ ë³‘í•©</strong>ì€ ê°™ì€ ê°’ì„ ê°€ì§„ ì—°ì†ëœ ì…€ë“¤ì„ í•˜ë‚˜ë¡œ í•©ì³ì„œ í‘œì‹œí•©ë‹ˆë‹¤.
      Wijmo FlexGridì˜ MergeManager íŒ¨í„´ì„ ì°¸ê³ í•˜ì—¬ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.
      ë³‘í•© ë°©ì‹ì„ ì„ íƒí•˜ê³  ì–´ë–¤ ì»¬ëŸ¼ì„ ë³‘í•©í• ì§€ ì„¤ì •í•´ë³´ì„¸ìš”.
    </p>
  </div>

  <div class="demo-container">
    <div class="toolbar">
      <div class="toolbar-group">
        <label>ë³‘í•© ë°©ì‹:</label>
        <select id="mergeTypeSelect" onchange="applyMerge()">
          <option value="none">ë³‘í•© ì—†ìŒ</option>
          <option value="content" selected>ê°™ì€ ê°’ ë³‘í•© (ContentMerge)</option>
          <option value="hierarchical">ê³„ì¸µì  ë³‘í•© (Hierarchical)</option>
          <option value="custom">ì»¤ìŠ¤í…€ ë³‘í•©</option>
        </select>
      </div>

      <div class="toolbar-divider"></div>

      <div class="toolbar-group">
        <label>ë³‘í•© ì»¬ëŸ¼:</label>
        <select id="mergeColumnSelect" onchange="applyMerge()">
          <option value="department" selected>ë¶€ì„œ</option>
          <option value="status">ìƒíƒœ</option>
          <option value="department,status">ë¶€ì„œ + ìƒíƒœ</option>
          <option value="all">ëª¨ë“  ì»¬ëŸ¼</option>
        </select>
      </div>

      <div class="toolbar-divider"></div>

      <div class="toolbar-group">
        <label>ì •ë ¬:</label>
        <select id="sortSelect" onchange="applySort()">
          <option value="department" selected>ë¶€ì„œìˆœ</option>
          <option value="status">ìƒíƒœìˆœ</option>
          <option value="salary">ê¸‰ì—¬ìˆœ</option>
          <option value="id">IDìˆœ</option>
        </select>
      </div>
    </div>

    <div id="grid"></div>

    <div class="status-bar" id="status">
      ì¤€ë¹„ë¨ - ë³‘í•© ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”
    </div>
  </div>

  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²•</h3>
    <pre><span class="keyword">import</span> { PureSheet, ContentMergeManager, HierarchicalMergeManager } <span class="keyword">from</span> <span class="string">'puresheet'</span>;

<span class="comment">// 1. ê°™ì€ ê°’ ë³‘í•© (ContentMergeManager)</span>
<span class="comment">// 'department' ì»¬ëŸ¼ì—ì„œ ê°™ì€ ê°’ì„ ê°€ì§„ ì—°ì†ëœ ì…€ ë³‘í•©</span>
grid.<span class="function">setMergeManager</span>(<span class="keyword">new</span> <span class="function">ContentMergeManager</span>([<span class="string">'department'</span>]));

<span class="comment">// 2. ê³„ì¸µì  ë³‘í•© (HierarchicalMergeManager)</span>
<span class="comment">// ìƒìœ„ ì»¬ëŸ¼ì˜ ë³‘í•© ë²”ìœ„ ë‚´ì—ì„œë§Œ í•˜ìœ„ ì»¬ëŸ¼ ë³‘í•©</span>
grid.<span class="function">setMergeManager</span>(<span class="keyword">new</span> <span class="function">HierarchicalMergeManager</span>([<span class="string">'department'</span>, <span class="string">'status'</span>]));

<span class="comment">// 3. ì»¤ìŠ¤í…€ ë³‘í•© (CustomMergeManager)</span>
<span class="keyword">import</span> { CustomMergeManager } <span class="keyword">from</span> <span class="string">'puresheet'</span>;
grid.<span class="function">setMergeManager</span>(<span class="keyword">new</span> <span class="function">CustomMergeManager</span>((row, col, data) => {
  <span class="comment">// ì»¤ìŠ¤í…€ ë³‘í•© ë¡œì§ êµ¬í˜„</span>
  <span class="keyword">return</span> { startRow, endRow, startCol, endCol };
}));

<span class="comment">// 4. ë³‘í•© í•´ì œ</span>
grid.<span class="function">setMergeManager</span>(<span class="keyword">null</span>);</pre>
  </div>

  <!-- ë³‘í•© ì •ë³´ -->
  <div class="info-panel">
    <h3>ğŸ“Š ë³‘í•© ì •ë³´</h3>
    <pre id="mergeInfo">{
  "type": "content",
  "columns": ["department"],
  "description": "ê°™ì€ ê°’ì„ ê°€ì§„ ì—°ì†ëœ ì…€ ë³‘í•©"
}</pre>
  </div>

  <!-- ì‚¬ìš© íŒ -->
  <div class="info-panel">
    <h3>ğŸ’¡ ë³‘í•© ë°©ì‹ ì„¤ëª…</h3>
    <ul style="line-height: 1.8; padding-left: 20px;">
      <li><strong>ê°™ì€ ê°’ ë³‘í•© (ContentMerge)</strong>: ì§€ì •ëœ ì»¬ëŸ¼ì—ì„œ ê°™ì€ ê°’ì´ ì—°ì†ë˜ë©´ ë³‘í•©</li>
      <li><strong>ê³„ì¸µì  ë³‘í•© (Hierarchical)</strong>: ìƒìœ„ ì»¬ëŸ¼ â†’ í•˜ìœ„ ì»¬ëŸ¼ ìˆœìœ¼ë¡œ ê³„ì¸µ ë³‘í•© (ë¶€ì„œê°€ ê°™ì€ ë²”ìœ„ ë‚´ì—ì„œë§Œ ìƒíƒœ ë³‘í•©)</li>
      <li><strong>ì»¤ìŠ¤í…€ ë³‘í•©</strong>: ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ë¡œ ë³‘í•© ë²”ìœ„ ì§ì ‘ ì§€ì •</li>
    </ul>
  </div>

  <script type="module">
    // PureSheet import
    const { PureSheet, ContentMergeManager, HierarchicalMergeManager, CustomMergeManager } = await import('../../src/index.ts');

    let grid = null;
    let currentData = [];

    // 100ê°œ ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ë¶€ì„œë³„ë¡œ ì •ë ¬ë¨)
    const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„', 'í•œì§€ë¯¼', 'ê°•í˜¸ë™', 'ìœ ì¬ì„', 'ì‹ ë™ì—½', 'ì†¡í˜œêµ'];
    const departments = ['Engineering', 'Engineering', 'Marketing', 'Marketing', 'Sales', 'Sales', 'HR', 'HR', 'Finance', 'Finance'];
    const statuses = ['Active', 'Active', 'Inactive', 'Active', 'Pending'];

    // ë³‘í•© íš¨ê³¼ê°€ ì˜ ë³´ì´ë„ë¡ ì •ë ¬ëœ ë°ì´í„° ìƒì„±
    currentData = [];
    departments.forEach((dept, deptIndex) => {
      const deptCount = 10; // ê° ë¶€ì„œë‹¹ 10ëª…
      for (let i = 0; i < deptCount; i++) {
        const globalIndex = deptIndex * deptCount + i;
        currentData.push({
          id: globalIndex + 1,
          name: names[i % names.length] + (Math.floor(globalIndex / 10) || ''),
          department: dept,
          status: statuses[(deptIndex + i) % statuses.length],
          salary: 50000 + Math.floor(Math.random() * 50000),
          joinDate: `202${deptIndex % 5}-${String((i % 12) + 1).padStart(2, '0')}-${String((i % 28) + 1).padStart(2, '0')}`
        });
      }
    });

    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    function updateMergeInfoDisplay(type, columns) {
      const descriptions = {
        none: 'ë³‘í•© ì—†ìŒ',
        content: 'ê°™ì€ ê°’ì„ ê°€ì§„ ì—°ì†ëœ ì…€ ë³‘í•©',
        hierarchical: 'ìƒìœ„ ì»¬ëŸ¼ ë²”ìœ„ ë‚´ì—ì„œ ê³„ì¸µì  ë³‘í•©',
        custom: 'ì»¤ìŠ¤í…€ ë¡œì§ìœ¼ë¡œ ë³‘í•© (ì˜ˆ: ì§ìˆ˜ í–‰ë¼ë¦¬ ë³‘í•©)',
      };

      const info = {
        type,
        columns: columns === 'all' ? ['department', 'status', 'salary', 'joinDate'] : columns.split(','),
        description: descriptions[type],
      };

      document.getElementById('mergeInfo').textContent = JSON.stringify(info, null, 2);
    }

    // ë³‘í•© ì ìš©
    window.applyMerge = function () {
      const mergeType = document.getElementById('mergeTypeSelect').value;
      const columnValue = document.getElementById('mergeColumnSelect').value;

      if (!grid) return;

      let columns = columnValue === 'all'
        ? ['department', 'status']
        : columnValue.split(',');

      switch (mergeType) {
        case 'none':
          grid.setMergeManager(null);
          updateStatus('ë³‘í•© í•´ì œë¨');
          break;

        case 'content':
          grid.setMergeManager(new ContentMergeManager(columns));
          updateStatus(`ê°™ì€ ê°’ ë³‘í•© ì ìš©: ${columns.join(', ')}`);
          break;

        case 'hierarchical':
          grid.setMergeManager(new HierarchicalMergeManager(columns));
          updateStatus(`ê³„ì¸µì  ë³‘í•© ì ìš©: ${columns.join(' â†’ ')}`);
          break;

        case 'custom':
          // ì»¤ìŠ¤í…€ ë³‘í•©: ê°™ì€ ë¶€ì„œ ë‚´ì—ì„œ ì§ìˆ˜ ì¸ë±ìŠ¤ í–‰ë¼ë¦¬ ë³‘í•©
          grid.setMergeManager(new CustomMergeManager((rowIndex, columnKey, data) => {
            if (columnKey !== 'department') return null;

            const currentDept = data[rowIndex]?.department;
            if (!currentDept) return null;

            // ê°™ì€ ë¶€ì„œì˜ ì‹œì‘ê³¼ ë ì°¾ê¸°
            let startRow = rowIndex;
            let endRow = rowIndex;

            while (startRow > 0 && data[startRow - 1]?.department === currentDept) {
              startRow--;
            }
            while (endRow < data.length - 1 && data[endRow + 1]?.department === currentDept) {
              endRow++;
            }

            if (startRow === endRow) return null;

            return { startRow, endRow, startCol: 0, endCol: 0 };
          }));
          updateStatus('ì»¤ìŠ¤í…€ ë³‘í•© ì ìš©: ë¶€ì„œë³„ ì „ì²´ ë³‘í•©');
          break;
      }

      updateMergeInfoDisplay(mergeType, columnValue);
    };

    // ì •ë ¬ ì ìš©
    window.applySort = async function () {
      const sortBy = document.getElementById('sortSelect').value;

      if (!grid) return;

      await grid.sort([{ columnKey: sortBy, direction: 'asc' }]);

      // ì •ë ¬ í›„ ë³‘í•© ë‹¤ì‹œ ì ìš© (ë°ì´í„° ìˆœì„œê°€ ë°”ë€Œë©´ ë³‘í•© ë²”ìœ„ë„ ë°”ë€œ)
      applyMerge();

      updateStatus(`${sortBy} ê¸°ì¤€ ì •ë ¬ ì™„ë£Œ`);
    };

    // ì´ˆê¸°í™”
    async function init() {
      const container = document.getElementById('grid');

      // í•„ë“œ ì •ì˜
      const fields = [
        { key: 'id', header: 'ID', dataType: 'number', width: 60 },
        { key: 'name', header: 'Name', dataType: 'string', width: 150 },
        { key: 'department', header: 'Department', dataType: 'string', width: 120 },
        { key: 'status', header: 'Status', dataType: 'string', width: 100 },
        { key: 'salary', header: 'Salary', dataType: 'number', width: 120, formatter: (v) => '$' + (v?.toLocaleString() || '0') },
        { key: 'joinDate', header: 'Join Date', dataType: 'string', width: 120 },
      ];

      // PureSheet ìƒì„±
      grid = new PureSheet(container, {
        mode: 'flat',
        fields,
        data: currentData,
        rowHeight: 36,
        headerHeight: 40,
        resizableColumns: true,
        theme: 'light',
      });

      // ì´ˆê¸° ì •ë ¬ (ë¶€ì„œìˆœ)
      await grid.sort([{ columnKey: 'department', direction: 'asc' }]);

      // ì´ˆê¸° ë³‘í•© ì ìš©
      applyMerge();

      updateStatus('100ê°œ í–‰ ë¡œë“œ ì™„ë£Œ - ë³‘í•© ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”');
    }

    init().catch(console.error);
  </script>
</body>

</html>