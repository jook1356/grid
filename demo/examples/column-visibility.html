<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¬ëŸ¼ ìˆ¨ê¸°ê¸° (Column Visibility) - PureSheet Demo</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <link rel="stylesheet" href="../../src/ui/style/default.css">
    <style>
        /* ì»¬ëŸ¼ ì œì–´ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .column-panel {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .panel-header h3 {
            margin: 0;
            font-size: 1rem;
            color: #333;
        }

        .panel-actions button {
            font-size: 0.85rem;
            padding: 4px 8px;
        }

        .column-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
        }

        .column-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            padding: 4px;
            border-radius: 4px;
        }

        .column-item:hover {
            background: #e9ecef;
        }

        .column-item label {
            cursor: pointer;
            user-select: none;
            flex: 1;
        }

        /* ê·¸ë¦¬ë“œ ë†’ì´ */
        #grid {
            height: 500px;
        }
    </style>
</head>

<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="demo-nav">
        <a href="../index.html">ğŸ  í™ˆ</a>
        <a href="pinning.html">ğŸ“Œ í–‰/ì»¬ëŸ¼ ê³ ì •</a>
        <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
        <a href="grouping.html">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
        <a href="merge.html">ğŸ”— ì…€ ë³‘í•©</a>
        <a href="selection-modes.html">ğŸ¯ ì„ íƒ ëª¨ë“œ</a>
        <a href="pivot.html">ğŸ“Š í”¼ë²—</a>
        <a href="format-row.html">ğŸ¨ formatRow</a>
        <a href="crud.html">âœï¸ CRUD</a>
        <a href="column-visibility.html" class="active">ğŸ‘ï¸ í•„ë“œ ì„ íƒ</a>
    </nav>

    <!-- í—¤ë” -->
    <div class="demo-header">
        <h1>ğŸ‘ï¸ ì»¬ëŸ¼ ìˆ¨ê¸°ê¸°/í‘œì‹œ (Column Visibility)</h1>
        <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
    </div>

    <!-- ì„¤ëª… -->
    <div class="demo-description">
        <p>
            <strong>ì»¬ëŸ¼ ê°€ì‹œì„± ì œì–´</strong> ê¸°ëŠ¥ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ í•„ìš”í•œ ì •ë³´ë§Œ ì„ ë³„í•˜ì—¬ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            <code>hidden: true</code> ì†ì„±ìœ¼ë¡œ ì´ˆê¸° ìˆ¨ê¹€ ìƒíƒœë¥¼ ì„¤ì •í•˜ê±°ë‚˜,
            <code>setColumnHidden()</code> APIë¡œ ë™ì ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
    </div>

    <div class="demo-container">
        <!-- ì»¬ëŸ¼ ì œì–´ íŒ¨ë„ -->
        <div class="column-panel">
            <div class="panel-header">
                <h3>í‘œì‹œí•  ì»¬ëŸ¼ ì„ íƒ</h3>
                <div class="panel-actions">
                    <button onclick="showAllColumns()" class="success">ëª¨ë‘ í‘œì‹œ</button>
                    <button onclick="hideAllColumns()" class="secondary">ëª¨ë‘ ìˆ¨ê¸°ê¸°</button>
                </div>
            </div>
            <div class="column-list" id="columnList">
                <!-- ì²´í¬ë°•ìŠ¤ê°€ JSë¡œ ìƒì„±ë¨ -->
            </div>
        </div>

        <div id="grid"></div>

        <div class="status-bar" id="status">
            ê·¸ë¦¬ë“œ ì¤€ë¹„ ì™„ë£Œ
        </div>
    </div>

    <!-- ì½”ë“œ ì˜ˆì œ -->
    <div class="code-example">
        <h3>API ì‚¬ìš©ë²•</h3>
        <pre><span class="comment">// 1. ì´ˆê¸° ìˆ¨ê¹€ ì„¤ì •</span>
<span class="keyword">const</span> sheet = <span class="keyword">new</span> <span class="function">PureSheet</span>(container, {
  fields: [
    { key: <span class="string">'id'</span>, header: <span class="string">'ID'</span> },
    { key: <span class="string">'secret'</span>, header: <span class="string">'ë¹„ë°€ê°’'</span>, <span class="property">hidden</span>: <span class="keyword">true</span> } <span class="comment">// ì²˜ìŒë¶€í„° ìˆ¨ê¹€</span>
  ],
  <span class="comment">// ...</span>
});

<span class="comment">// 2. ë™ì  ì œì–´</span>
sheet.<span class="function">setColumnHidden</span>(<span class="string">'email'</span>, <span class="keyword">true</span>);  <span class="comment">// ìˆ¨ê¸°ê¸°</span>
sheet.<span class="function">setColumnHidden</span>(<span class="string">'email'</span>, <span class="keyword">false</span>); <span class="comment">// ë³´ì´ê¸°</span>

<span class="comment">// 3. í† ê¸€</span>
sheet.<span class="function">toggleColumn</span>(<span class="string">'email'</span>);</pre>
    </div>

    <script type="module">
        import { PureSheet } from '../../src/index.ts';

        let sheet = null;

        // ë°ì´í„° ìƒì„±
        function generateData(count) {
            const departments = ['Engineering', 'Sales', 'Marketing', 'HR', 'Finance', 'Legal', 'Operations'];
            const statuses = ['Active', 'Inactive', 'Pending', 'Suspended'];
            const positions = ['Manager', 'Developer', 'Designer', 'Analyst', 'Director', 'Intern'];
            const locations = ['Seoul', 'New York', 'London', 'Tokyo', 'Singapore', 'Berlin'];

            return Array.from({ length: count }, (_, i) => ({
                id: i + 1,
                name: `User ${i + 1}`,
                email: `user${i + 1}@example.com`,
                phone: `010-${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}-${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`,
                department: departments[i % departments.length],
                position: positions[i % positions.length],
                status: statuses[i % statuses.length],
                location: locations[i % locations.length],
                salary: Math.floor(50000 + Math.random() * 100000),
                bonus: Math.floor(1000 + Math.random() * 20000),
                rating: (Math.random() * 5).toFixed(1),
                joinDate: `202${Math.floor(i % 5)}-${String((i % 12) + 1).padStart(2, '0')}-${String((i % 28) + 1).padStart(2, '0')}`,
                notes: `Note for user ${i + 1} with some long text to test column width...`,
            }));
        }

        // í•„ë“œ ì •ì˜
        const fields = [
            { key: 'id', header: 'ID', dataType: 'number', width: 60, pinned: 'left' },
            { key: 'name', header: 'Name', dataType: 'string', width: 120, pinned: 'left' },

            // ì‚¬ìš©ì ìƒì„¸ ì •ë³´
            { key: 'email', header: 'Email', dataType: 'string', width: 200 },
            { key: 'phone', header: 'Phone', dataType: 'string', width: 130, hidden: true }, // ì´ˆê¸° ìˆ¨ê¹€

            // ì—…ë¬´ ì •ë³´
            { key: 'department', header: 'Department', dataType: 'string', width: 120 },
            { key: 'position', header: 'Position', dataType: 'string', width: 120 },
            { key: 'location', header: 'Location', dataType: 'string', width: 100 },

            // ê¸‰ì—¬ ë° í‰ê°€ (ë¯¼ê° ì •ë³´ - ì´ˆê¸° ìˆ¨ê¹€ ê°€ëŠ¥)
            { key: 'salary', header: 'Salary', dataType: 'number', width: 100, formatter: v => '$' + v.toLocaleString() },
            { key: 'bonus', header: 'Bonus', dataType: 'number', width: 100, formatter: v => '$' + v.toLocaleString(), hidden: true }, // ì´ˆê¸° ìˆ¨ê¹€
            { key: 'rating', header: 'Rating', dataType: 'number', width: 80 },

            // ê¸°íƒ€
            { key: 'status', header: 'Status', dataType: 'string', width: 90 },
            { key: 'joinDate', header: 'Join Date', dataType: 'string', width: 100 },
            { key: 'notes', header: 'Notes', dataType: 'string', width: 300, hidden: true }, // ì´ˆê¸° ìˆ¨ê¹€
        ];

        async function init() {
            const container = document.getElementById('grid');

            sheet = new PureSheet(container, {
                mode: 'flat',
                fields,
                rowHeight: 36,
                headerHeight: 40,
                resizableColumns: true,
                theme: 'light',
            });

            // ë°ì´í„° ë¡œë“œ
            await sheet.loadData(generateData(100));

            // UI ì´ˆê¸°í™”
            initColumnControl();

            document.getElementById('status').textContent = '100ê°œ í–‰ ë¡œë“œë¨. ì²´í¬ë°•ìŠ¤ë¡œ ì»¬ëŸ¼ì„ ì œì–´í•´ë³´ì„¸ìš”.';
        }

        // ì»¬ëŸ¼ ì œì–´ íŒ¨ë„ ì´ˆê¸°í™”
        function initColumnControl() {
            const list = document.getElementById('columnList');
            list.innerHTML = '';

            fields.forEach(field => {
                const div = document.createElement('div');
                div.className = 'column-item';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `col-${field.key}`;
                checkbox.checked = !field.hidden; // ì´ˆê¸° ìƒíƒœ ë°˜ì˜

                // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                checkbox.addEventListener('change', (e) => {
                    const isVisible = e.target.checked;
                    sheet.setColumnHidden(field.key, !isVisible);

                    const action = isVisible ? 'í‘œì‹œ' : 'ìˆ¨ê¹€';
                    document.getElementById('status').textContent = `'${field.header}' ì»¬ëŸ¼ ${action}`;
                });

                const label = document.createElement('label');
                label.htmlFor = `col-${field.key}`;
                label.textContent = field.header;

                // ì¤‘ìš” ì»¬ëŸ¼/ìˆ¨ê²¨ì§„ ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ íŒíŠ¸
                if (field.pinned) {
                    label.style.fontWeight = 'bold';
                    label.innerHTML += ' ğŸ“Œ';
                }

                div.appendChild(checkbox);
                div.appendChild(label);
                list.appendChild(div);
            });
        }

        // ì „ì—­ í•¨ìˆ˜
        window.showAllColumns = function () {
            if (!sheet) return;

            fields.forEach(field => {
                sheet.setColumnHidden(field.key, false);
            });

            // ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë™ê¸°í™”
            document.querySelectorAll('.column-list input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
            document.getElementById('status').textContent = 'ëª¨ë“  ì»¬ëŸ¼ í‘œì‹œ';
        };

        window.hideAllColumns = function () {
            if (!sheet) return;

            // IDì™€ Nameì€ ë‚¨ê²¨ë‘ê¸° (ì‚¬ìš©ì„±ì„ ìœ„í•´)
            const keepColumns = ['id', 'name'];

            fields.forEach(field => {
                if (!keepColumns.includes(field.key)) {
                    sheet.setColumnHidden(field.key, true);
                }
            });

            // ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë™ê¸°í™”
            document.querySelectorAll('.column-list input[type="checkbox"]').forEach(cb => {
                const key = cb.id.replace('col-', '');
                cb.checked = keepColumns.includes(key);
            });
            document.getElementById('status').textContent = 'ìµœì†Œ ì»¬ëŸ¼ë§Œ í‘œì‹œ';
        };

        init().catch(console.error);
    </script>
</body>

</html>