<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í–‰ ê³ ì • (Pinned Rows) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
  <style>
    .row-preview {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .row-preview h4 {
      margin: 0 0 12px 0;
      color: var(--text);
      font-size: 14px;
    }
    .preview-content {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .preview-item {
      background: var(--bg);
      border: 1px dashed var(--border);
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 12px;
      color: var(--text-muted);
    }
    .preview-item.top {
      border-color: #4CAF50;
      background: rgba(76, 175, 80, 0.1);
    }
    .preview-item.bottom {
      border-color: #2196F3;
      background: rgba(33, 150, 243, 0.1);
    }
    .action-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }
    .action-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
    }
    .action-card h4 {
      margin: 0 0 12px 0;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    .action-card button {
      width: 100%;
      margin-top: 8px;
    }
    .action-card select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--bg);
      color: var(--text);
    }
    .custom-row-input {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    .custom-row-input input {
      flex: 1;
      padding: 8px;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--bg);
      color: var(--text);
    }
  </style>
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="column-pinning.html">ğŸ“Œ ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
    <a href="pinned-rows.html" class="active">ğŸ“ í–‰ ê³ ì •</a>
    <a href="selection-modes.html">ğŸ¯ ì„ íƒ ëª¨ë“œ</a>
  </nav>
  
  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ“ í–‰ ê³ ì • (Pinned Rows)</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>
  
  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>í–‰ ê³ ì •</strong>ì€ íŠ¹ì • í–‰ì„ ê·¸ë¦¬ë“œì˜ ìƒë‹¨ ë˜ëŠ” í•˜ë‹¨ì— ê³ ì •ì‹œí‚¤ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.
      ìŠ¤í¬ë¡¤í•´ë„ í•­ìƒ ë³´ì´ë©°, ì§‘ê³„(í•©ê³„, í‰ê·  ë“±)ë‚˜ í•„í„° í–‰ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      ì»¬ëŸ¼ ê³ ì •ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ì‹œ í•¨ê»˜ ë™ê¸°í™”ë©ë‹ˆë‹¤.
    </p>
  </div>

  <div class="demo-container">
    <!-- í˜„ì¬ ê³ ì •ëœ í–‰ ë¯¸ë¦¬ë³´ê¸° -->
    <div class="row-preview">
      <h4>ğŸ“Š í˜„ì¬ ê³ ì •ëœ í–‰</h4>
      <div class="preview-content" id="pinnedPreview">
        <span style="color: var(--text-muted); font-size: 12px;">ê³ ì •ëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤</span>
      </div>
    </div>

    <!-- í–‰ ì¶”ê°€ ì•¡ì…˜ ì¹´ë“œ -->
    <div class="action-cards">
      <!-- ìƒë‹¨ ê³ ì • í–‰ ì¶”ê°€ -->
      <div class="action-card">
        <h4>â¬†ï¸ ìƒë‹¨ ê³ ì • í–‰</h4>
        <select id="topRowType">
          <option value="sum">í•©ê³„ (Sum)</option>
          <option value="avg">í‰ê·  (Average)</option>
          <option value="count">ê°œìˆ˜ (Count)</option>
          <option value="filter">í•„í„° í–‰</option>
          <option value="custom">ì»¤ìŠ¤í…€ í–‰</option>
        </select>
        <button onclick="addTopRow()">ìƒë‹¨ì— ì¶”ê°€</button>
      </div>

      <!-- í•˜ë‹¨ ê³ ì • í–‰ ì¶”ê°€ -->
      <div class="action-card">
        <h4>â¬‡ï¸ í•˜ë‹¨ ê³ ì • í–‰</h4>
        <select id="bottomRowType">
          <option value="sum" selected>í•©ê³„ (Sum)</option>
          <option value="avg">í‰ê·  (Average)</option>
          <option value="count">ê°œìˆ˜ (Count)</option>
          <option value="grandtotal">ì´í•©ê³„ (Grand Total)</option>
          <option value="custom">ì»¤ìŠ¤í…€ í–‰</option>
        </select>
        <button onclick="addBottomRow()">í•˜ë‹¨ì— ì¶”ê°€</button>
      </div>

      <!-- ê³ ì • í–‰ ê´€ë¦¬ -->
      <div class="action-card">
        <h4>ğŸ”§ ê´€ë¦¬</h4>
        <button onclick="clearTop()" class="secondary">ìƒë‹¨ ì „ì²´ ì œê±°</button>
        <button onclick="clearBottom()" class="secondary">í•˜ë‹¨ ì „ì²´ ì œê±°</button>
        <button onclick="clearAll()" class="danger">ëª¨ë“  ê³ ì • í–‰ ì œê±°</button>
      </div>
    </div>
    
    <div id="grid"></div>
    
    <div class="status-bar" id="status">
      ì¤€ë¹„ë¨ - ìƒë‹¨/í•˜ë‹¨ì— ê³ ì • í–‰ì„ ì¶”ê°€í•´ë³´ì„¸ìš”
    </div>
  </div>
  
  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²•</h3>
    <pre><span class="keyword">import</span> { Row } <span class="keyword">from</span> <span class="string">'puresheet'</span>;

<span class="comment">// ì§‘ê³„ í–‰ ìƒì„±</span>
<span class="keyword">const</span> sumRow = <span class="keyword">new</span> <span class="function">Row</span>({
  id: <span class="string">'sum-row'</span>,
  structural: <span class="keyword">true</span>,
  variant: <span class="string">'subtotal'</span>,
  pinned: <span class="string">'bottom'</span>,
  aggregates: [
    { columnKey: <span class="string">'salary'</span>, func: <span class="string">'sum'</span>, formatter: v => <span class="string">'$'</span> + v.toLocaleString() },
    { columnKey: <span class="string">'bonus'</span>, func: <span class="string">'sum'</span> },
  ],
});

<span class="comment">// ì»¤ìŠ¤í…€ ë Œë” í–‰</span>
<span class="keyword">const</span> customRow = <span class="keyword">new</span> <span class="function">Row</span>({
  structural: <span class="keyword">true</span>,
  variant: <span class="string">'custom'</span>,
  pinned: <span class="string">'top'</span>,
  render: (container, ctx) => {
    container.innerHTML = <span class="string">'&lt;div&gt;Custom content here&lt;/div&gt;'</span>;
  },
});

<span class="comment">// BodyRendererì— ê³ ì • í–‰ ì¶”ê°€</span>
<span class="keyword">const</span> bodyRenderer = renderer.<span class="function">getBodyRenderer</span>();
bodyRenderer.<span class="function">addPinnedTopRow</span>(customRow);
bodyRenderer.<span class="function">addPinnedBottomRow</span>(sumRow);

<span class="comment">// ê³ ì • í–‰ ì œê±°</span>
bodyRenderer.<span class="function">removePinnedTopRow</span>(<span class="string">'sum-row'</span>);
bodyRenderer.<span class="function">clearPinnedRows</span>();

<span class="comment">// í˜„ì¬ ê³ ì • í–‰ ì¡°íšŒ</span>
<span class="keyword">const</span> { top, bottom } = bodyRenderer.<span class="function">getPinnedRows</span>();</pre>
  </div>
  
  <!-- íƒ€ì… ì •ë³´ -->
  <div class="info-panel">
    <h3>ğŸ“ Row íƒ€ì…</h3>
    <pre id="typeInfo"><span class="keyword">interface</span> RowConfig {
  id?: <span class="type">string</span>;                <span class="comment">// ê³ ìœ  ID (ìë™ ìƒì„±ë¨)</span>
  structural?: <span class="type">boolean</span>;       <span class="comment">// êµ¬ì¡°ì  í–‰ ì—¬ë¶€ (ì„ íƒ/ì¸ë±ìŠ¤ ì œì™¸)</span>
  variant?: <span class="type">RowVariant</span>;       <span class="comment">// 'data' | 'group-header' | 'subtotal' | 'grandtotal' | 'filter' | 'custom'</span>
  pinned?: <span class="string">'top'</span> | <span class="string">'bottom'</span>;  <span class="comment">// ê³ ì • ìœ„ì¹˜</span>
  height?: <span class="type">number</span>;            <span class="comment">// í–‰ ë†’ì´ (ê¸°ë³¸ê°’: rowHeight)</span>
  data?: <span class="type">Record&lt;string, any&gt;</span>; <span class="comment">// í–‰ ë°ì´í„°</span>
  aggregates?: <span class="type">AggregateConfig[]</span>; <span class="comment">// ì§‘ê³„ ì„¤ì •</span>
  render?: <span class="type">(container, ctx) => void</span>; <span class="comment">// ì»¤ìŠ¤í…€ ë Œë”ëŸ¬</span>
  className?: <span class="type">string</span>;         <span class="comment">// ì¶”ê°€ CSS í´ë˜ìŠ¤</span>
}</pre>
  </div>
  
  <script type="module">
    // GridCoreì™€ GridRenderer import
    const { GridCore, GridRenderer, Row } = await import('../../src/index.ts');
    
    let gridCore = null;
    let renderer = null;
    let pinnedRowCounter = 0;
    
    // 100ê°œ ìƒ˜í”Œ ë°ì´í„° ìƒì„±
    const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„', 'í•œì§€ë¯¼', 'ê°•í˜¸ë™', 'ìœ ì¬ì„', 'ì‹ ë™ì—½', 'ì†¡í˜œêµ'];
    const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'];
    
    const sampleData = Array.from({ length: 100 }, (_, i) => ({
      id: i + 1,
      name: names[i % names.length] + (Math.floor(i / 10) || ''),
      department: departments[i % departments.length],
      salary: 50000 + Math.floor(Math.random() * 50000),
      bonus: 1000 + Math.floor(Math.random() * 9000),
      performance: Math.floor(Math.random() * 100),
    }));
    
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }
    
    function updatePinnedPreview() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      
      const { top, bottom } = bodyRenderer.getPinnedRows();
      const preview = document.getElementById('pinnedPreview');
      
      if (top.length === 0 && bottom.length === 0) {
        preview.innerHTML = '<span style="color: var(--text-muted); font-size: 12px;">ê³ ì •ëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤</span>';
        return;
      }
      
      let html = '';
      top.forEach(row => {
        html += `<div class="preview-item top">â¬†ï¸ ${row.variant} (${row.id})</div>`;
      });
      bottom.forEach(row => {
        html += `<div class="preview-item bottom">â¬‡ï¸ ${row.variant} (${row.id})</div>`;
      });
      
      preview.innerHTML = html;
    }
    
    // ì§‘ê³„ê°’ ê³„ì‚°
    function calculateAggregate(func, columnKey) {
      const values = sampleData.map(d => d[columnKey]).filter(v => typeof v === 'number');
      switch (func) {
        case 'sum': return values.reduce((a, b) => a + b, 0);
        case 'avg': return Math.round(values.reduce((a, b) => a + b, 0) / values.length);
        case 'count': return values.length;
        case 'min': return Math.min(...values);
        case 'max': return Math.max(...values);
        default: return 0;
      }
    }
    
    // í–‰ ìƒì„± í•¨ìˆ˜ë“¤
    function createAggregateRow(type, position) {
      const id = `${type}-${position}-${++pinnedRowCounter}`;
      
      // ì§‘ê³„ê°’ ë¯¸ë¦¬ ê³„ì‚°
      const data = {
        id: type.toUpperCase(),
        name: type === 'sum' ? 'í•©ê³„' : type === 'avg' ? 'í‰ê· ' : type === 'count' ? 'ê°œìˆ˜' : 'ì´í•©ê³„',
        department: '-',
        salary: calculateAggregate(type === 'grandtotal' ? 'sum' : type, 'salary'),
        bonus: calculateAggregate(type === 'grandtotal' ? 'sum' : type, 'bonus'),
        performance: calculateAggregate(type === 'grandtotal' ? 'sum' : type === 'count' ? 'count' : 'avg', 'performance'),
      };
      
      return new Row({
        id,
        structural: true,
        variant: type === 'grandtotal' ? 'grandtotal' : 'subtotal',
        pinned: position,
        data,
        className: `ps-aggregate-${type}`,
      });
    }
    
    function createFilterRow(position) {
      const id = `filter-${position}-${++pinnedRowCounter}`;
      
      return new Row({
        id,
        structural: true,
        variant: 'filter',
        pinned: position,
        render: (container, ctx) => {
          // ì…€ ì»¨í…Œì´ë„ˆ êµ¬ì¡° í™•ì¸
          let centerContainer = container.querySelector('.ps-cells-center');
          if (!centerContainer) {
            container.innerHTML = `
              <div class="ps-cells-left"></div>
              <div class="ps-cells-center"></div>
              <div class="ps-cells-right"></div>
            `;
            centerContainer = container.querySelector('.ps-cells-center');
          }
          
          // í•„í„° ì…ë ¥ í•„ë“œ ìƒì„±
          let html = '';
          ctx.columns.forEach(col => {
            if (col.visible) {
              html += `
                <div class="ps-cell" style="width: ${col.width}px; min-width: ${col.width}px;">
                  <input type="text" 
                    placeholder="Filter ${col.key}..." 
                    style="width: 100%; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;"
                    onchange="window.filterColumn('${col.key}', this.value)"
                  >
                </div>
              `;
            }
          });
          
          centerContainer.innerHTML = html;
          centerContainer.style.display = 'flex';
          centerContainer.style.alignItems = 'center';
        },
      });
    }
    
    function createCustomRow(position) {
      const id = `custom-${position}-${++pinnedRowCounter}`;
      
      return new Row({
        id,
        structural: true,
        variant: 'custom',
        pinned: position,
        render: (container, ctx) => {
          // ì…€ ì»¨í…Œì´ë„ˆ êµ¬ì¡° í™•ì¸
          let centerContainer = container.querySelector('.ps-cells-center');
          if (!centerContainer) {
            container.innerHTML = `
              <div class="ps-cells-left"></div>
              <div class="ps-cells-center"></div>
              <div class="ps-cells-right"></div>
            `;
            centerContainer = container.querySelector('.ps-cells-center');
          }
          
          centerContainer.innerHTML = `
            <div style="
              display: flex;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: 100%;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              font-weight: 600;
              font-size: 14px;
              border-radius: 4px;
              gap: 8px;
            ">
              <span>âœ¨</span>
              <span>ì»¤ìŠ¤í…€ ë Œë” í–‰ - ì›í•˜ëŠ” ë‚´ìš©ì„ ììœ ë¡­ê²Œ êµ¬ì„±!</span>
              <span>âœ¨</span>
            </div>
          `;
          centerContainer.style.display = 'flex';
          centerContainer.style.padding = '4px';
        },
      });
    }
    
    // ìƒë‹¨ í–‰ ì¶”ê°€
    window.addTopRow = function() {
      const type = document.getElementById('topRowType').value;
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      
      let row;
      switch (type) {
        case 'filter':
          row = createFilterRow('top');
          break;
        case 'custom':
          row = createCustomRow('top');
          break;
        default:
          row = createAggregateRow(type, 'top');
      }
      
      bodyRenderer.addPinnedTopRow(row);
      updatePinnedPreview();
      updateStatus(`ìƒë‹¨ì— ${type} í–‰ ì¶”ê°€ë¨`);
    };
    
    // í•˜ë‹¨ í–‰ ì¶”ê°€
    window.addBottomRow = function() {
      const type = document.getElementById('bottomRowType').value;
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      
      let row;
      switch (type) {
        case 'custom':
          row = createCustomRow('bottom');
          break;
        default:
          row = createAggregateRow(type, 'bottom');
      }
      
      bodyRenderer.addPinnedBottomRow(row);
      updatePinnedPreview();
      updateStatus(`í•˜ë‹¨ì— ${type} í–‰ ì¶”ê°€ë¨`);
    };
    
    // ìƒë‹¨ ì „ì²´ ì œê±°
    window.clearTop = function() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      
      const { top } = bodyRenderer.getPinnedRows();
      top.forEach(row => bodyRenderer.removePinnedTopRow(row.id));
      updatePinnedPreview();
      updateStatus('ìƒë‹¨ ê³ ì • í–‰ ëª¨ë‘ ì œê±°ë¨');
    };
    
    // í•˜ë‹¨ ì „ì²´ ì œê±°
    window.clearBottom = function() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      
      const { bottom } = bodyRenderer.getPinnedRows();
      bottom.forEach(row => bodyRenderer.removePinnedBottomRow(row.id));
      updatePinnedPreview();
      updateStatus('í•˜ë‹¨ ê³ ì • í–‰ ëª¨ë‘ ì œê±°ë¨');
    };
    
    // ì „ì²´ ì œê±°
    window.clearAll = function() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      
      bodyRenderer.clearPinnedRows();
      updatePinnedPreview();
      updateStatus('ëª¨ë“  ê³ ì • í–‰ ì œê±°ë¨');
    };
    
    // í•„í„° (ë°ëª¨ìš©)
    window.filterColumn = function(columnKey, value) {
      console.log(`Filter ${columnKey}: ${value}`);
      updateStatus(`í•„í„°: ${columnKey} = "${value}" (ë°ëª¨ìš© - ì‹¤ì œ í•„í„°ë§ ë¯¸êµ¬í˜„)`);
    };
    
    // ì´ˆê¸°í™”
    async function init() {
      const container = document.getElementById('grid');
      
      const columns = [
        { key: 'id', header: 'ID', width: 60 },
        { key: 'name', header: 'Name', width: 120 },
        { key: 'department', header: 'Department', width: 120 },
        { key: 'salary', header: 'Salary', width: 120, formatter: (v) => '$' + (v?.toLocaleString() || '0') },
        { key: 'bonus', header: 'Bonus', width: 100, formatter: (v) => '$' + (v?.toLocaleString() || '0') },
        { key: 'performance', header: 'Performance', width: 100, formatter: (v) => v + '%' },
      ];
      
      gridCore = new GridCore({ columns });
      await gridCore.initialize();
      
      renderer = new GridRenderer(container, {
        gridCore,
        options: {
          columns,
          rowHeight: 36,
          headerHeight: 40,
          resizableColumns: true,
          theme: 'light',
        },
        onRowClick: (rowIndex, row) => {
          console.log('Row clicked:', rowIndex, row);
        },
      });
      
      // ë°ì´í„° ë¡œë“œ
      await gridCore.loadData(sampleData);
      renderer.refresh();
      
      // ê¸°ë³¸ í•˜ë‹¨ í•©ê³„ í–‰ ì¶”ê°€
      const bodyRenderer = renderer.getBodyRenderer();
      const defaultSumRow = createAggregateRow('sum', 'bottom');
      bodyRenderer.addPinnedBottomRow(defaultSumRow);
      
      updatePinnedPreview();
      updateStatus('100ê°œ í–‰ ë¡œë“œ ì™„ë£Œ - ìƒë‹¨/í•˜ë‹¨ì— ê³ ì • í–‰ì„ ì¶”ê°€í•´ë³´ì„¸ìš”');
    }
    
    init().catch(console.error);
  </script>
</body>
</html>

