<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í–‰/ì»¬ëŸ¼ ê³ ì • (Row & Column Pinning) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
  <style>
    .preview-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 12px;
      display: flex;
      gap: 32px;
      flex-wrap: wrap;
    }
    .preview-section {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .preview-label {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 500;
    }
    .preview-items {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .preview-item {
      background: var(--bg);
      border: 1px dashed var(--border);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 11px;
      color: var(--text-muted);
    }
    .preview-item.top { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
    .preview-item.bottom { border-color: #2196F3; background: rgba(33, 150, 243, 0.1); }
    .preview-item.left { border-color: #FF9800; background: rgba(255, 152, 0, 0.1); }
    .preview-item.right { border-color: #9C27B0; background: rgba(156, 39, 176, 0.1); }
  </style>
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="pinned-rows.html" class="active">ğŸ“Œ í–‰/ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
    <a href="selection-modes.html">ğŸ¯ ì„ íƒ ëª¨ë“œ</a>
  </nav>
  
  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ“Œ í–‰/ì»¬ëŸ¼ ê³ ì • (Row & Column Pinning)</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>
  
  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>í–‰ ê³ ì •</strong>ì€ ìƒë‹¨/í•˜ë‹¨ì— ì§‘ê³„, í•„í„°, ì»¤ìŠ¤í…€ í–‰ì„ ê³ ì •í•©ë‹ˆë‹¤.
      <strong>ì»¬ëŸ¼ ê³ ì •</strong>ì€ ì™¼ìª½/ì˜¤ë¥¸ìª½ì— ì»¬ëŸ¼ì„ ê³ ì •í•©ë‹ˆë‹¤.
      ë‘ ê¸°ëŠ¥ì„ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ê°€ë¡œ/ì„¸ë¡œ ìŠ¤í¬ë¡¤ì—ë„ íŠ¹ì • í–‰ê³¼ ì»¬ëŸ¼ì´ í•­ìƒ í‘œì‹œë©ë‹ˆë‹¤.
    </p>
  </div>
  
  <div class="demo-container">
    <!-- í˜„ì¬ ê³ ì • ìƒíƒœ ë¯¸ë¦¬ë³´ê¸° -->
    <div class="preview-panel">
      <div class="preview-section">
        <span class="preview-label">í–‰ ê³ ì •:</span>
        <div class="preview-items" id="pinnedPreview">
          <span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>
        </div>
      </div>
      <div class="preview-section">
        <span class="preview-label">ì»¬ëŸ¼ ê³ ì •:</span>
        <div class="preview-items" id="columnPreview">
          <span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>
        </div>
      </div>
    </div>

    <!-- í–‰ ê³ ì • íˆ´ë°” -->
    <div class="toolbar">
      <div class="toolbar-group">
        <label>â¬†ï¸ ìƒë‹¨ í–‰:</label>
        <select id="topRowType">
          <option value="sum">í•©ê³„</option>
          <option value="avg">í‰ê· </option>
          <option value="count">ê°œìˆ˜</option>
          <option value="filter">í•„í„°</option>
          <option value="custom">ì»¤ìŠ¤í…€</option>
        </select>
        <button onclick="addTopRow()" class="success">ì¶”ê°€</button>
        <button onclick="clearTop()" class="secondary">ì œê±°</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>â¬‡ï¸ í•˜ë‹¨ í–‰:</label>
        <select id="bottomRowType">
          <option value="sum" selected>í•©ê³„</option>
          <option value="avg">í‰ê· </option>
          <option value="count">ê°œìˆ˜</option>
          <option value="grandtotal">ì´í•©ê³„</option>
          <option value="custom">ì»¤ìŠ¤í…€</option>
        </select>
        <button onclick="addBottomRow()" class="success">ì¶”ê°€</button>
        <button onclick="clearBottom()" class="secondary">ì œê±°</button>
      </div>
    </div>

    <!-- ì»¬ëŸ¼ ê³ ì • íˆ´ë°” -->
    <div class="toolbar">
      <div class="toolbar-group">
        <label>ğŸ“Œ ì»¬ëŸ¼:</label>
        <select id="columnSelect">
          <option value="id">ID</option>
          <option value="name">Name</option>
          <option value="department">Department</option>
          <option value="salary">Salary</option>
          <option value="bonus">Bonus</option>
          <option value="performance">Performance</option>
        </select>
        <button onclick="pinColumnLeft()" class="success">â† ì™¼ìª½ ê³ ì •</button>
        <button onclick="pinColumnRight()" class="success">ì˜¤ë¥¸ìª½ ê³ ì • â†’</button>
        <button onclick="unpinColumn()" class="secondary">ê³ ì • í•´ì œ</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <button onclick="resetAll()" class="warning">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </div>
    
    <div id="grid"></div>
    
    <div class="status-bar" id="status">
      ì¤€ë¹„ë¨ - í–‰ê³¼ ì»¬ëŸ¼ì„ ê³ ì •í•´ë³´ì„¸ìš”
    </div>
  </div>
  
  <!-- í˜„ì¬ ìƒíƒœ -->
  <div class="info-panel">
    <h3>ğŸ“Š í˜„ì¬ ê³ ì • ìƒíƒœ</h3>
    <pre id="pinState">{
  "rows": { "top": [], "bottom": ["sum"] },
  "columns": { "left": ["id"], "right": [] }
}</pre>
  </div>
  
  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²•</h3>
    <pre><span class="keyword">import</span> { Row } <span class="keyword">from</span> <span class="string">'puresheet'</span>;

<span class="comment">// ì§‘ê³„ í–‰ ìƒì„± ë° ê³ ì •</span>
<span class="keyword">const</span> sumRow = <span class="keyword">new</span> <span class="function">Row</span>({
  structural: <span class="keyword">true</span>,
  variant: <span class="string">'subtotal'</span>,
  pinned: <span class="string">'bottom'</span>,
  data: { name: <span class="string">'í•©ê³„'</span>, salary: 1000000 },
});

<span class="keyword">const</span> bodyRenderer = renderer.<span class="function">getBodyRenderer</span>();
bodyRenderer.<span class="function">addPinnedBottomRow</span>(sumRow);

<span class="comment">// ì»¬ëŸ¼ ê³ ì •</span>
renderer.<span class="function">setColumnPinned</span>(<span class="string">'id'</span>, <span class="string">'left'</span>);
renderer.<span class="function">setColumnPinned</span>(<span class="string">'actions'</span>, <span class="string">'right'</span>);
renderer.<span class="function">setColumnPinned</span>(<span class="string">'name'</span>, <span class="string">'none'</span>); <span class="comment">// í•´ì œ</span></pre>
  </div>
  
  <script type="module">
    const { GridCore, GridRenderer, Row } = await import('../../src/index.ts');
    
    let gridCore = null;
    let renderer = null;
    let pinnedRowCounter = 0;
    
    // ìƒ˜í”Œ ë°ì´í„°
    const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„', 'í•œì§€ë¯¼', 'ê°•í˜¸ë™', 'ìœ ì¬ì„', 'ì‹ ë™ì—½', 'ì†¡í˜œêµ'];
    const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'];
    
    const sampleData = Array.from({ length: 100 }, (_, i) => ({
      id: i + 1,
      name: names[i % names.length] + (Math.floor(i / 10) || ''),
      department: departments[i % departments.length],
      salary: 50000 + Math.floor(Math.random() * 50000),
      bonus: 1000 + Math.floor(Math.random() * 9000),
      performance: Math.floor(Math.random() * 100),
    }));
    
    // ìƒíƒœ ì¶”ì 
    let columnPinState = {
      leftPinned: ['id'],
      center: ['name', 'department', 'salary', 'bonus', 'performance'],
      rightPinned: []
    };
    
    const columnHeaders = {
      id: 'ID', name: 'Name', department: 'Department',
      salary: 'Salary', bonus: 'Bonus', performance: 'Performance'
    };
    
    function updateStatus(msg) {
      document.getElementById('status').textContent = msg;
    }
    
    function updatePinStateDisplay() {
      const bodyRenderer = renderer?.getBodyRenderer();
      const { top, bottom } = bodyRenderer ? bodyRenderer.getPinnedRows() : { top: [], bottom: [] };
      
      const state = {
        rows: {
          top: top.map(r => r.variant),
          bottom: bottom.map(r => r.variant)
        },
        columns: {
          left: columnPinState.leftPinned,
          right: columnPinState.rightPinned
        }
      };
      document.getElementById('pinState').textContent = JSON.stringify(state, null, 2);
    }
    
    function updatePinnedPreview() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      
      const { top, bottom } = bodyRenderer.getPinnedRows();
      const preview = document.getElementById('pinnedPreview');
      
      if (top.length === 0 && bottom.length === 0) {
        preview.innerHTML = '<span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>';
      } else {
        let html = '';
        top.forEach(row => { html += `<span class="preview-item top">â¬†ï¸ ${row.variant}</span>`; });
        bottom.forEach(row => { html += `<span class="preview-item bottom">â¬‡ï¸ ${row.variant}</span>`; });
        preview.innerHTML = html;
      }
      updatePinStateDisplay();
    }
    
    function updateColumnPreview() {
      const preview = document.getElementById('columnPreview');
      if (columnPinState.leftPinned.length === 0 && columnPinState.rightPinned.length === 0) {
        preview.innerHTML = '<span class="preview-item" style="border-style: solid; opacity: 0.5;">ì—†ìŒ</span>';
      } else {
        let html = '';
        columnPinState.leftPinned.forEach(k => { html += `<span class="preview-item left">â¬…ï¸ ${columnHeaders[k]}</span>`; });
        columnPinState.rightPinned.forEach(k => { html += `<span class="preview-item right">â¡ï¸ ${columnHeaders[k]}</span>`; });
        preview.innerHTML = html;
      }
      updatePinStateDisplay();
    }
    
    // ì§‘ê³„ê°’ ê³„ì‚°
    function calcAggregate(func, key) {
      const vals = sampleData.map(d => d[key]).filter(v => typeof v === 'number');
      if (func === 'sum') return vals.reduce((a, b) => a + b, 0);
      if (func === 'avg') return Math.round(vals.reduce((a, b) => a + b, 0) / vals.length);
      if (func === 'count') return vals.length;
      return 0;
    }
    
    // í–‰ ìƒì„± í•¨ìˆ˜ë“¤
    function createAggregateRow(type, position) {
      const id = `${type}-${position}-${++pinnedRowCounter}`;
      const data = {
        id: type.toUpperCase(),
        name: type === 'sum' ? 'í•©ê³„' : type === 'avg' ? 'í‰ê· ' : type === 'count' ? 'ê°œìˆ˜' : 'ì´í•©ê³„',
        department: '-',
        salary: calcAggregate(type === 'grandtotal' ? 'sum' : type, 'salary'),
        bonus: calcAggregate(type === 'grandtotal' ? 'sum' : type, 'bonus'),
        performance: calcAggregate(type === 'grandtotal' ? 'sum' : type === 'count' ? 'count' : 'avg', 'performance'),
      };
      return new Row({ id, structural: true, variant: type === 'grandtotal' ? 'grandtotal' : 'subtotal', pinned: position, data });
    }
    
    function createFilterRow(position) {
      return new Row({
        id: `filter-${position}-${++pinnedRowCounter}`,
        structural: true,
        variant: 'filter',
        pinned: position,
        render: (container, ctx) => {
          let left = container.querySelector('.ps-cells-left');
          let center = container.querySelector('.ps-cells-center');
          let right = container.querySelector('.ps-cells-right');
          if (!center) {
            container.innerHTML = '<div class="ps-cells-left"></div><div class="ps-cells-center"></div><div class="ps-cells-right"></div>';
            left = container.querySelector('.ps-cells-left');
            center = container.querySelector('.ps-cells-center');
            right = container.querySelector('.ps-cells-right');
          }
          const makeInputs = cols => cols.filter(c => c.visible).map(c => `
            <div class="ps-cell" style="width:${c.width}px;min-width:${c.width}px;">
              <input type="text" placeholder="Filter..." style="width:100%;padding:4px 6px;border:1px solid #ddd;border-radius:3px;font-size:11px;">
            </div>
          `).join('');
          left.innerHTML = makeInputs(ctx.columnGroups.left);
          center.innerHTML = makeInputs(ctx.columnGroups.center);
          right.innerHTML = makeInputs(ctx.columnGroups.right);
          [left, center, right].forEach(c => { c.style.display = 'flex'; c.style.alignItems = 'center'; });
        },
      });
    }
    
    function createCustomRow(position) {
      return new Row({
        id: `custom-${position}-${++pinnedRowCounter}`,
        structural: true,
        variant: 'custom',
        pinned: position,
        render: (container, ctx) => {
          let left = container.querySelector('.ps-cells-left');
          let center = container.querySelector('.ps-cells-center');
          let right = container.querySelector('.ps-cells-right');
          if (!center) {
            container.innerHTML = '<div class="ps-cells-left"></div><div class="ps-cells-center"></div><div class="ps-cells-right"></div>';
            left = container.querySelector('.ps-cells-left');
            center = container.querySelector('.ps-cells-center');
            right = container.querySelector('.ps-cells-right');
          }
          const lw = ctx.columnGroups.left.reduce((s, c) => s + (c.visible ? c.width : 0), 0);
          const rw = ctx.columnGroups.right.reduce((s, c) => s + (c.visible ? c.width : 0), 0);
          const gradient = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
          left.innerHTML = lw > 0 ? `<div style="width:${lw}px;height:100%;display:flex;align-items:center;justify-content:center;background:${gradient};color:white;">ğŸ“Œ</div>` : '';
          center.innerHTML = `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:${gradient};color:white;font-weight:600;font-size:13px;gap:8px;"><span>âœ¨</span><span>ì»¤ìŠ¤í…€ í–‰</span><span>âœ¨</span></div>`;
          right.innerHTML = rw > 0 ? `<div style="width:${rw}px;height:100%;display:flex;align-items:center;justify-content:center;background:${gradient};color:white;">ğŸ“Œ</div>` : '';
          [left, center, right].forEach(c => { c.style.display = 'flex'; });
          center.style.padding = '4px';
        },
      });
    }
    
    // í–‰ ê³ ì • í•¨ìˆ˜
    window.addTopRow = function() {
      const type = document.getElementById('topRowType').value;
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      const row = type === 'filter' ? createFilterRow('top') : type === 'custom' ? createCustomRow('top') : createAggregateRow(type, 'top');
      bodyRenderer.addPinnedTopRow(row);
      updatePinnedPreview();
      updateStatus(`ìƒë‹¨ì— ${type} í–‰ ì¶”ê°€ë¨`);
    };
    
    window.addBottomRow = function() {
      const type = document.getElementById('bottomRowType').value;
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      const row = type === 'custom' ? createCustomRow('bottom') : createAggregateRow(type, 'bottom');
      bodyRenderer.addPinnedBottomRow(row);
      updatePinnedPreview();
      updateStatus(`í•˜ë‹¨ì— ${type} í–‰ ì¶”ê°€ë¨`);
    };
    
    window.clearTop = function() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      bodyRenderer.getPinnedRows().top.forEach(r => bodyRenderer.removePinnedTopRow(r.id));
      updatePinnedPreview();
      updateStatus('ìƒë‹¨ ê³ ì • í–‰ ì œê±°ë¨');
    };
    
    window.clearBottom = function() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (!bodyRenderer) return;
      bodyRenderer.getPinnedRows().bottom.forEach(r => bodyRenderer.removePinnedBottomRow(r.id));
      updatePinnedPreview();
      updateStatus('í•˜ë‹¨ ê³ ì • í–‰ ì œê±°ë¨');
    };
    
    // ì»¬ëŸ¼ ê³ ì • í•¨ìˆ˜
    window.pinColumnLeft = function() {
      const key = document.getElementById('columnSelect').value;
      columnPinState.leftPinned = columnPinState.leftPinned.filter(k => k !== key);
      columnPinState.center = columnPinState.center.filter(k => k !== key);
      columnPinState.rightPinned = columnPinState.rightPinned.filter(k => k !== key);
      columnPinState.leftPinned.push(key);
      renderer?.setColumnPinned(key, 'left');
      updateColumnPreview();
      updateStatus(`"${columnHeaders[key]}" ì™¼ìª½ ê³ ì •ë¨`);
    };
    
    window.pinColumnRight = function() {
      const key = document.getElementById('columnSelect').value;
      columnPinState.leftPinned = columnPinState.leftPinned.filter(k => k !== key);
      columnPinState.center = columnPinState.center.filter(k => k !== key);
      columnPinState.rightPinned = columnPinState.rightPinned.filter(k => k !== key);
      columnPinState.rightPinned.push(key);
      renderer?.setColumnPinned(key, 'right');
      updateColumnPreview();
      updateStatus(`"${columnHeaders[key]}" ì˜¤ë¥¸ìª½ ê³ ì •ë¨`);
    };
    
    window.unpinColumn = function() {
      const key = document.getElementById('columnSelect').value;
      if (!columnPinState.leftPinned.includes(key) && !columnPinState.rightPinned.includes(key)) {
        updateStatus(`"${columnHeaders[key]}" ì»¬ëŸ¼ì€ ê³ ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤`);
        return;
      }
      columnPinState.leftPinned = columnPinState.leftPinned.filter(k => k !== key);
      columnPinState.rightPinned = columnPinState.rightPinned.filter(k => k !== key);
      if (!columnPinState.center.includes(key)) columnPinState.center.push(key);
      renderer?.setColumnPinned(key, 'none');
      updateColumnPreview();
      updateStatus(`"${columnHeaders[key]}" ê³ ì • í•´ì œë¨`);
    };
    
    window.resetAll = function() {
      const bodyRenderer = renderer?.getBodyRenderer();
      if (bodyRenderer) bodyRenderer.clearPinnedRows();
      
      const allCols = ['id', 'name', 'department', 'salary', 'bonus', 'performance'];
      allCols.forEach(k => renderer?.setColumnPinned(k, 'none'));
      columnPinState = { leftPinned: [], center: allCols, rightPinned: [] };
      
      updatePinnedPreview();
      updateColumnPreview();
      updateStatus('ëª¨ë“  ê³ ì • ìƒíƒœ ì´ˆê¸°í™”ë¨');
    };
    
    // ì´ˆê¸°í™”
    async function init() {
      const container = document.getElementById('grid');
      
      const columns = [
        { key: 'id', header: 'ID', width: 60, pinned: 'left' },
        { key: 'name', header: 'Name', width: 120 },
        { key: 'department', header: 'Department', width: 120 },
        { key: 'salary', header: 'Salary', width: 120, formatter: v => '$' + (v?.toLocaleString() || '0') },
        { key: 'bonus', header: 'Bonus', width: 100, formatter: v => '$' + (v?.toLocaleString() || '0') },
        { key: 'performance', header: 'Performance', width: 100, formatter: v => v + '%' },
      ];
      
      gridCore = new GridCore({ columns });
      await gridCore.initialize();
      
      renderer = new GridRenderer(container, {
        gridCore,
        options: { columns, rowHeight: 36, headerHeight: 40, resizableColumns: true, theme: 'light' },
        onRowClick: (rowIndex, row) => console.log('Row clicked:', rowIndex, row),
      });
      
      await gridCore.loadData(sampleData);
      renderer.refresh();
      
      // ê¸°ë³¸ í•˜ë‹¨ í•©ê³„ í–‰ ì¶”ê°€
      const bodyRenderer = renderer.getBodyRenderer();
      bodyRenderer.addPinnedBottomRow(createAggregateRow('sum', 'bottom'));
      
      updatePinnedPreview();
      updateColumnPreview();
      updateStatus('100ê°œ í–‰ ë¡œë“œ ì™„ë£Œ - í–‰ê³¼ ì»¬ëŸ¼ì„ ê³ ì •í•´ë³´ì„¸ìš”!');
    }
    
    init().catch(console.error);
  </script>
</body>
</html>
