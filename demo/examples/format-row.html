<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>formatRow API - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
  <style>
    /* formatRow ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */

    /* ê³ ê°€ ì œí’ˆ í•˜ì´ë¼ì´íŠ¸ */
    .highlight-expensive {
      background-color: rgba(255, 193, 7, 0.15) !important;
    }

    /* ì¬ê³  ë¶€ì¡± ê²½ê³  */
    .low-stock {
      background-color: rgba(244, 67, 54, 0.1) !important;
    }

    .low-stock-cell {
      color: #d32f2f !important;
      font-weight: 600 !important;
    }

    /* ë†’ì€ ìˆ˜ìµ í•˜ì´ë¼ì´íŠ¸ */
    .high-profit {
      background-color: rgba(76, 175, 80, 0.1) !important;
    }

    .high-profit-cell {
      color: #2e7d32 !important;
      font-weight: 600 !important;
    }

    /* ìŒìˆ˜ ê°’ */
    .negative-value {
      color: #d32f2f !important;
    }

    /* ì–‘ìˆ˜ ê°’ */
    .positive-value {
      color: #2e7d32 !important;
    }

    /* ê·¸ë£¹ í—¤ë” ì»¤ìŠ¤í…€ */
    .group-header-level-0 {
      background-color: rgba(25, 118, 210, 0.1) !important;
    }

    .group-header-level-1 {
      background-color: rgba(25, 118, 210, 0.05) !important;
    }

    /* í”¼ë²— í–‰ í•˜ì´ë¼ì´íŠ¸ */
    .pivot-row-highlight {
      background-color: rgba(156, 39, 176, 0.08) !important;
    }

    /* í”¼ë²— ì…€ í•˜ì´ë¼ì´íŠ¸ */
    .pivot-high-value {
      background-color: rgba(76, 175, 80, 0.2) !important;
      font-weight: 600 !important;
    }

    .pivot-low-value {
      background-color: rgba(244, 67, 54, 0.15) !important;
    }

    /* ë‘ ê·¸ë¦¬ë“œ ë‚˜ë€íˆ í‘œì‹œ */
    .grid-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .grid-column {
      flex: 1;
      min-width: 0;
    }

    .grid-column h3 {
      margin-bottom: 12px;
      font-size: 1.1rem;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .grid-column .demo-container {
      height: 100%;
    }

    .grid-column #flatGrid,
    .grid-column #pivotGrid {
      height: 400px;
    }

    /* ë²”ë¡€ */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      padding: 12px 16px;
      background: #f9f9f9;
      border-bottom: 1px solid var(--demo-border);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 1200px) {
      .grid-row {
        flex-direction: column;
      }
    }
  </style>
  <script src="../shared/nav-sidebar.js" defer></script>
</head>

<body>
  <!-- ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav-sidebar></nav-sidebar>

  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ¨ formatRow API</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>

  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>formatRow</strong>ëŠ” í–‰ì´ ë Œë”ë§ë  ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ëŠ” ì½œë°±ì…ë‹ˆë‹¤.
      Wijmoì˜ <code>formatItem</code>ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ <strong>í–‰ ë‹¨ìœ„</strong>ë¡œ í˜¸ì¶œë˜ì–´ 20ë°° ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤.
      ë°ì´í„° ê°’ì— ë”°ë¼ ì¡°ê±´ë¶€ ìŠ¤íƒ€ì¼ë§, í•˜ì´ë¼ì´íŒ…, ì…€ í¬ë§·íŒ… ë“±ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </p>
  </div>

  <!-- ë²”ë¡€ -->
  <div class="demo-container" style="margin-bottom: 20px;">
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(255, 193, 7, 0.15);"></div>
        <span>ê³ ê°€ ì œí’ˆ (ê°€ê²© â‰¥ 800)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(244, 67, 54, 0.1);"></div>
        <span>ì¬ê³  ë¶€ì¡± (ì¬ê³  â‰¤ 20)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(76, 175, 80, 0.1);"></div>
        <span>ë†’ì€ ìˆ˜ìµ (ìˆ˜ìµ â‰¥ 500)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(156, 39, 176, 0.08);"></div>
        <span>í”¼ë²— ì£¼ìš” ì œí’ˆ</span>
      </div>
    </div>
  </div>

  <!-- ê·¸ë¦¬ë“œ ì˜ì—­ -->
  <div class="grid-row">
    <!-- ì¼ë°˜ ê·¸ë¦¬ë“œ (Flat Mode) -->
    <div class="grid-column">
      <h3>ğŸ“‹ ì¼ë°˜ ê·¸ë¦¬ë“œ (Flat Mode)</h3>
      <div class="demo-container">
        <div class="toolbar">
          <div class="toolbar-group">
            <label>ê·¸ë£¹í™”:</label>
            <select id="groupSelect" onchange="updateGrouping()">
              <option value="">ì—†ìŒ</option>
              <option value="category">ì¹´í…Œê³ ë¦¬</option>
              <option value="category,status">ì¹´í…Œê³ ë¦¬ â†’ ìƒíƒœ</option>
            </select>
          </div>
          <div class="toolbar-divider"></div>
          <div class="toolbar-group">
            <button onclick="addSampleRow()">â• í–‰ ì¶”ê°€</button>
            <button onclick="modifySampleRow()" class="secondary">âœï¸ ìˆ˜ì •</button>
          </div>
          <div class="toolbar-divider"></div>
          <div class="toolbar-group">
            <button onclick="toggleFlatFormatRow()" class="secondary" id="toggleFlatBtn">formatRow ë„ê¸°</button>
          </div>
        </div>
        <div id="flatGrid"></div>
        <div class="status-bar" id="flatStatus">ì´ˆê¸°í™” ì¤‘...</div>
      </div>
    </div>

    <!-- í”¼ë²— ê·¸ë¦¬ë“œ -->
    <div class="grid-column">
      <h3>ğŸ“Š í”¼ë²— ê·¸ë¦¬ë“œ (Pivot Mode)</h3>
      <div class="demo-container">
        <div class="toolbar">
          <div class="toolbar-group">
            <label>ê°’ í•„ë“œ:</label>
            <select id="valueSelect" onchange="updatePivotValue()">
              <option value="sales">íŒë§¤ëŸ‰</option>
              <option value="profit">ìˆ˜ìµ</option>
              <option value="sales,profit">íŒë§¤ëŸ‰ + ìˆ˜ìµ</option>
            </select>
          </div>
          <div class="toolbar-divider"></div>
          <div class="toolbar-group">
            <button onclick="togglePivotFormatRow()" class="secondary" id="togglePivotBtn">formatRow ë„ê¸°</button>
          </div>
        </div>
        <div id="pivotGrid"></div>
        <div class="status-bar" id="pivotStatus">ì´ˆê¸°í™” ì¤‘...</div>
      </div>
    </div>
  </div>

  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>formatRow API ì‚¬ìš©ë²•</h3>
    <pre><span class="comment">// PureSheet ìƒì„± ì‹œ formatRow ì˜µì…˜ ì „ë‹¬</span>
<span class="keyword">const</span> grid = <span class="keyword">new</span> <span class="function">PureSheet</span>(container, {
  fields: [...],
  data: [...],

  <span class="comment">// formatRow ì½œë°± - í–‰ì´ ë Œë”ë§ë  ë•Œë§ˆë‹¤ í˜¸ì¶œ</span>
  <span class="property">formatRow</span>: (info) => {
    <span class="comment">// Discriminated Unionìœ¼ë¡œ íƒ€ì… ì•ˆì „í•˜ê²Œ ì²˜ë¦¬</span>
    <span class="keyword">switch</span> (info.type) {
      <span class="keyword">case</span> <span class="string">'data'</span>:
        <span class="keyword">const</span> { ctx } = info;
        <span class="keyword">const</span> { data, rowElement, cells, rowState } = ctx;

        <span class="comment">// ì¡°ê±´ë¶€ í–‰ ìŠ¤íƒ€ì¼ë§</span>
        <span class="keyword">if</span> (data.price >= <span class="number">800</span>) {
          rowElement.classList.add(<span class="string">'highlight-expensive'</span>);
        }

        <span class="comment">// ì…€ë³„ ìŠ¤íƒ€ì¼ë§</span>
        <span class="keyword">if</span> (cells.stock && data.stock &lt;= <span class="number">20</span>) {
          cells.stock.element.classList.add(<span class="string">'low-stock-cell'</span>);
        }

        <span class="comment">// Dirty State ì²˜ë¦¬</span>
        <span class="keyword">if</span> (rowState === <span class="string">'modified'</span>) {
          <span class="comment">// ìˆ˜ì •ëœ í–‰ íŠ¹ë³„ ì²˜ë¦¬</span>
        }
        <span class="keyword">break</span>;

      <span class="keyword">case</span> <span class="string">'group-header'</span>:
        <span class="keyword">const</span> { level, element, itemCount } = info.ctx;
        <span class="comment">// ê·¸ë£¹ í—¤ë” ì»¤ìŠ¤í„°ë§ˆì´ì§•</span>
        element.classList.add(<span class="string">`group-level-${level}`</span>);
        <span class="keyword">break</span>;
    }
  },
});

<span class="comment">// ëŸ°íƒ€ì„ì— formatRow ë³€ê²½</span>
grid.<span class="function">setFormatRow</span>(newFormatRowCallback);

<span class="comment">// formatRow í•´ì œ</span>
grid.<span class="function">setFormatRow</span>(<span class="keyword">null</span>);</pre>
  </div>

  <!-- FormatRowInfo íƒ€ì… ì„¤ëª… -->
  <div class="code-example">
    <h3>FormatRowInfo íƒ€ì… êµ¬ì¡°</h3>
    <pre><span class="comment">// Discriminated Union - íƒ€ì… ì•ˆì „í•œ í–‰ íƒ€ì… êµ¬ë¶„</span>
<span class="keyword">type</span> FormatRowInfo =
  | { <span class="property">type</span>: <span class="string">'data'</span>;        <span class="property">ctx</span>: DataRowContext }
  | { <span class="property">type</span>: <span class="string">'group-header'</span>; <span class="property">ctx</span>: GroupHeaderContext }
  | { <span class="property">type</span>: <span class="string">'subtotal'</span>;     <span class="property">ctx</span>: SubtotalContext }
  | { <span class="property">type</span>: <span class="string">'grand-total'</span>;  <span class="property">ctx</span>: SubtotalContext };

<span class="comment">// DataRowContext - ë°ì´í„° í–‰ ì •ë³´</span>
<span class="keyword">interface</span> DataRowContext {
  <span class="property">viewIndex</span>: <span class="keyword">number</span>;           <span class="comment">// í™”ë©´ìƒ ì¸ë±ìŠ¤</span>
  <span class="property">dataIndex</span>: <span class="keyword">number</span>;           <span class="comment">// ë°ì´í„° ì¸ë±ìŠ¤</span>
  <span class="property">rowId</span>?: <span class="keyword">string</span> | <span class="keyword">number</span>;    <span class="comment">// í–‰ ID (CRUD ì•ˆì „)</span>
  <span class="property">data</span>: Row;                    <span class="comment">// í–‰ ë°ì´í„°</span>
  <span class="property">groupPath</span>: <span class="keyword">string</span>[];          <span class="comment">// ê·¸ë£¹ ê²½ë¡œ</span>
  <span class="property">rowState</span>: RowState;           <span class="comment">// 'pristine' | 'added' | 'modified' | 'deleted'</span>
  <span class="property">rowElement</span>: HTMLElement;      <span class="comment">// í–‰ DOM ìš”ì†Œ</span>
  <span class="property">cells</span>: Record&lt;<span class="keyword">string</span>, CellInfo&gt;; <span class="comment">// columnKey â†’ CellInfo</span>
}

<span class="comment">// CellInfo - ì…€ ì •ë³´</span>
<span class="keyword">interface</span> CellInfo {
  <span class="property">element</span>: HTMLElement;         <span class="comment">// ì…€ DOM ìš”ì†Œ</span>
  <span class="property">value</span>: CellValue;             <span class="comment">// í˜„ì¬ ê°’</span>
  <span class="property">originalValue</span>?: CellValue;   <span class="comment">// ì›ë³¸ ê°’ (ìˆ˜ì • ì‹œ)</span>
  <span class="property">isModified</span>: <span class="keyword">boolean</span>;          <span class="comment">// ìˆ˜ì • ì—¬ë¶€</span>
}</pre>
  </div>

  <script type="module">
    import { PureSheet } from '../../src/index.ts';

    let flatGrid = null;
    let pivotGrid = null;
    let flatData = [];
    let pivotData = [];
    let nextId = 1000;

    // =========================================================================
    // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
    // =========================================================================

    const categories = ['ì „ìì œí’ˆ', 'ì˜ë¥˜', 'ì‹í’ˆ', 'ê°€êµ¬', 'ìŠ¤í¬ì¸ '];
    const statuses = ['íŒë§¤ì¤‘', 'í’ˆì ˆì„ë°•', 'ì‹ ìƒí’ˆ'];
    const products = ['ë…¸íŠ¸ë¶', 'ìŠ¤ë§ˆíŠ¸í°', 'íƒœë¸”ë¦¿', 'ëª¨ë‹ˆí„°', 'í‚¤ë³´ë“œ', 'ë§ˆìš°ìŠ¤', 'í—¤ë“œí°', 'ìŠ¤í”¼ì»¤'];
    const regions = ['ì„œìš¸', 'ë¶€ì‚°', 'ëŒ€êµ¬', 'ì¸ì²œ'];
    const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”'];

    // Flat ê·¸ë¦¬ë“œìš© ë°ì´í„°
    function generateFlatData() {
      const data = [];
      for (let i = 1; i <= 50; i++) {
        data.push({
          id: i,
          name: `ì œí’ˆ ${i}`,
          category: categories[Math.floor(Math.random() * categories.length)],
          status: statuses[Math.floor(Math.random() * statuses.length)],
          price: Math.floor(Math.random() * 900) + 100,
          stock: Math.floor(Math.random() * 100),
          profit: Math.floor(Math.random() * 800) - 200,
        });
      }
      return data;
    }

    // Pivot ê·¸ë¦¬ë“œìš© ë°ì´í„°
    function generatePivotData() {
      const data = [];
      let id = 1;
      for (const product of products) {
        for (const region of regions) {
          for (const month of months) {
            data.push({
              id: id++,
              product,
              region,
              month,
              sales: Math.floor(Math.random() * 200) + 50,
              profit: Math.floor(Math.random() * 100) - 20,
            });
          }
        }
      }
      return data;
    }

    // =========================================================================
    // Flat Grid formatRow
    // =========================================================================

    function flatFormatRow(info) {
      if (info.type === 'data') {
        const { data, rowElement, cells, rowState } = info.ctx;

        // ì´ì „ í´ë˜ìŠ¤ ì œê±° (ì¬ì‚¬ìš©ë˜ëŠ” DOM ìš”ì†Œ ëŒ€ì‘)
        rowElement.classList.remove('highlight-expensive', 'low-stock', 'high-profit');

        // ê³ ê°€ ì œí’ˆ í•˜ì´ë¼ì´íŠ¸ (ê°€ê²© >= 800)
        if (data.price >= 800) {
          rowElement.classList.add('highlight-expensive');
        }

        // ì¬ê³  ë¶€ì¡± í–‰ (ì¬ê³  <= 20)
        if (data.stock <= 20) {
          rowElement.classList.add('low-stock');
        }

        // ë†’ì€ ìˆ˜ìµ í–‰ (ìˆ˜ìµ >= 500)
        if (data.profit >= 500) {
          rowElement.classList.add('high-profit');
        }

        // ì…€ë³„ ìŠ¤íƒ€ì¼ë§
        // ì¬ê³  ì…€ - ë¶€ì¡±í•˜ë©´ ë¹¨ê°„ìƒ‰
        if (cells.stock) {
          cells.stock.element.classList.remove('low-stock-cell');
          if (data.stock <= 20) {
            cells.stock.element.classList.add('low-stock-cell');
          }
        }

        // ìˆ˜ìµ ì…€ - ìŒìˆ˜/ì–‘ìˆ˜ ìƒ‰ìƒ
        if (cells.profit) {
          cells.profit.element.classList.remove('negative-value', 'positive-value', 'high-profit-cell');
          if (data.profit < 0) {
            cells.profit.element.classList.add('negative-value');
          } else if (data.profit >= 500) {
            cells.profit.element.classList.add('high-profit-cell');
          } else {
            cells.profit.element.classList.add('positive-value');
          }
        }

        // Dirty State í‘œì‹œ (ì´ë¯¸ CSSë¡œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš©ë¨)
        // ì¶”ê°€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ í•„ìš”í•˜ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬
        if (rowState === 'added') {
          // ìƒˆë¡œ ì¶”ê°€ëœ í–‰ - ì¶”ê°€ ì²˜ë¦¬ ê°€ëŠ¥
        } else if (rowState === 'modified') {
          // ìˆ˜ì •ëœ í–‰ - ì¶”ê°€ ì²˜ë¦¬ ê°€ëŠ¥
        }

      } else if (info.type === 'group-header') {
        const { level, element, itemCount } = info.ctx;

        // ê·¸ë£¹ ë ˆë²¨ë³„ ìŠ¤íƒ€ì¼
        element.classList.remove('group-header-level-0', 'group-header-level-1');
        element.classList.add(`group-header-level-${level}`);
      }
    }

    // =========================================================================
    // Pivot Grid formatRow
    // =========================================================================

    function pivotFormatRow(info) {
      if (info.type === 'data') {
        const { data, rowElement, cells } = info.ctx;

        // ì´ì „ í´ë˜ìŠ¤ ì œê±°
        rowElement.classList.remove('pivot-row-highlight');

        // ì£¼ìš” ì œí’ˆ í•˜ì´ë¼ì´íŠ¸ (ë…¸íŠ¸ë¶, ìŠ¤ë§ˆíŠ¸í°)
        const product = data.product;
        if (product === 'ë…¸íŠ¸ë¶' || product === 'ìŠ¤ë§ˆíŠ¸í°') {
          rowElement.classList.add('pivot-row-highlight');
        }

        // í”¼ë²— ì…€ ê°’ ê¸°ë°˜ ìŠ¤íƒ€ì¼ë§
        for (const [columnKey, cellInfo] of Object.entries(cells)) {
          // í”¼ë²— ê°’ ì»¬ëŸ¼ë§Œ ì²˜ë¦¬ (product ì œì™¸)
          if (columnKey === 'product') continue;

          cellInfo.element.classList.remove('pivot-high-value', 'pivot-low-value');

          const value = cellInfo.value;
          if (typeof value === 'number') {
            // ë†’ì€ ê°’ í•˜ì´ë¼ì´íŠ¸ (>=150)
            if (value >= 150) {
              cellInfo.element.classList.add('pivot-high-value');
            }
            // ë‚®ì€ ê°’ í‘œì‹œ (<50)
            else if (value < 50 && value > 0) {
              cellInfo.element.classList.add('pivot-low-value');
            }
          }
        }
      }
    }

    // =========================================================================
    // ì´ˆê¸°í™”
    // =========================================================================

    async function initFlatGrid() {
      const container = document.getElementById('flatGrid');
      flatData = generateFlatData();

      const fields = [
        { key: 'id', header: 'ID', dataType: 'number', width: 60 },
        { key: 'name', header: 'ì œí’ˆëª…', dataType: 'string', width: 120 },
        { key: 'category', header: 'ì¹´í…Œê³ ë¦¬', dataType: 'string', width: 100 },
        { key: 'status', header: 'ìƒíƒœ', dataType: 'string', width: 90 },
        { key: 'price', header: 'ê°€ê²©', dataType: 'number', width: 100 },
        { key: 'stock', header: 'ì¬ê³ ', dataType: 'number', width: 80 },
        { key: 'profit', header: 'ìˆ˜ìµ', dataType: 'number', width: 100 },
      ];

      flatGrid = new PureSheet(container, {
        mode: 'flat',
        fields,
        data: flatData,
        formatRow: flatFormatRow,
        theme: 'light',
      });

      document.getElementById('flatStatus').textContent =
        `${flatData.length}ê°œ í–‰ ë¡œë“œë¨ - formatRowë¡œ ì¡°ê±´ë¶€ ìŠ¤íƒ€ì¼ë§ ì ìš©`;
    }

    async function initPivotGrid() {
      const container = document.getElementById('pivotGrid');
      pivotData = generatePivotData();

      const fields = [
        { key: 'product', header: 'ì œí’ˆ', dataType: 'string' },
        { key: 'region', header: 'ì§€ì—­', dataType: 'string' },
        { key: 'month', header: 'ì›”', dataType: 'string' },
        { key: 'sales', header: 'íŒë§¤ëŸ‰', dataType: 'number', aggregate: 'sum' },
        { key: 'profit', header: 'ìˆ˜ìµ', dataType: 'number', aggregate: 'sum' },
      ];

      pivotGrid = new PureSheet(container, {
        mode: 'pivot',
        rowFields: [{ field: 'product', header: 'ì œí’ˆ' }],
        columnFields: [{ field: 'month', header: 'ì›”' }],
        valueFields: [{ field: 'sales', aggregate: 'sum', header: 'íŒë§¤ëŸ‰' }],
        formatRow: pivotFormatRow,
        theme: 'light',
      });

      await pivotGrid.loadData(pivotData);

      document.getElementById('pivotStatus').textContent =
        `í”¼ë²— ì™„ë£Œ - ë†’ì€ ê°’(â‰¥150) ë…¹ìƒ‰, ë‚®ì€ ê°’(<50) ë¹¨ê°• í•˜ì´ë¼ì´íŠ¸`;
    }

    // =========================================================================
    // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    // =========================================================================

    window.updateGrouping = function () {
      if (!flatGrid) return;

      const groupSelect = document.getElementById('groupSelect');
      const groupValue = groupSelect.value;

      if (groupValue) {
        const columns = groupValue.split(',');
        flatGrid.setGrouping({ columns });
      } else {
        flatGrid.setGrouping(null);
      }
    };

    window.updatePivotValue = function () {
      if (!pivotGrid) return;

      const valueSelect = document.getElementById('valueSelect');
      const values = valueSelect.value.split(',');

      pivotGrid.setPivotConfig({
        rowFields: [{ field: 'product', header: 'ì œí’ˆ' }],
        columnFields: [{ field: 'month', header: 'ì›”' }],
        valueFields: values.map(v => ({
          field: v,
          aggregate: 'sum',
          header: v === 'sales' ? 'íŒë§¤ëŸ‰' : 'ìˆ˜ìµ',
        })),
      });
    };

    window.addSampleRow = async function () {
      if (!flatGrid) return;

      const newRow = {
        id: ++nextId,
        name: `ìƒˆ ì œí’ˆ ${nextId}`,
        category: categories[Math.floor(Math.random() * categories.length)],
        status: 'ì‹ ìƒí’ˆ',
        price: Math.floor(Math.random() * 500) + 500,
        stock: Math.floor(Math.random() * 50),
        profit: Math.floor(Math.random() * 300) + 200,
      };

      await flatGrid.addRow(newRow);
      document.getElementById('flatStatus').textContent =
        `í–‰ ì¶”ê°€ë¨ (ID: ${nextId}) - Dirty State: added`;
    };

    window.modifySampleRow = async function () {
      if (!flatGrid) return;

      // ì²« ë²ˆì§¸ í–‰ ìˆ˜ì •
      const firstRow = flatData[0];
      if (firstRow) {
        await flatGrid.updateRow(firstRow.id, {
          price: firstRow.price + 100,
          profit: firstRow.profit + 50,
        });
        document.getElementById('flatStatus').textContent =
          `í–‰ ìˆ˜ì •ë¨ (ID: ${firstRow.id}) - Dirty State: modified`;
      }
    };

    // formatRow í† ê¸€ ìƒíƒœ
    let flatFormatRowEnabled = true;

    window.toggleFlatFormatRow = function () {
      if (!flatGrid) return;

      flatFormatRowEnabled = !flatFormatRowEnabled;

      if (flatFormatRowEnabled) {
        flatGrid.setFormatRow(flatFormatRow);
        document.getElementById('toggleFlatBtn').textContent = 'formatRow ë„ê¸°';
        document.getElementById('flatStatus').textContent = 'formatRow í™œì„±í™”ë¨';
      } else {
        flatGrid.setFormatRow(null);
        document.getElementById('toggleFlatBtn').textContent = 'formatRow ì¼œê¸°';
        document.getElementById('flatStatus').textContent = 'formatRow ë¹„í™œì„±í™”ë¨ - ì¡°ê±´ë¶€ ìŠ¤íƒ€ì¼ ì—†ìŒ';
      }
    };

    // Pivot formatRow í† ê¸€ ìƒíƒœ
    let pivotFormatRowEnabled = true;

    window.togglePivotFormatRow = function () {
      if (!pivotGrid) return;

      pivotFormatRowEnabled = !pivotFormatRowEnabled;

      if (pivotFormatRowEnabled) {
        pivotGrid.setFormatRow(pivotFormatRow);
        document.getElementById('togglePivotBtn').textContent = 'formatRow ë„ê¸°';
        document.getElementById('pivotStatus').textContent = 'í”¼ë²— formatRow í™œì„±í™”ë¨';
      } else {
        pivotGrid.setFormatRow(null);
        document.getElementById('togglePivotBtn').textContent = 'formatRow ì¼œê¸°';
        document.getElementById('pivotStatus').textContent = 'í”¼ë²— formatRow ë¹„í™œì„±í™”ë¨ - ì¡°ê±´ë¶€ ìŠ¤íƒ€ì¼ ì—†ìŒ';
      }
    };

    // ì´ˆê¸°í™” ì‹¤í–‰
    Promise.all([
      initFlatGrid(),
      initPivotGrid(),
    ]).catch(console.error);
  </script>
</body>

</html>