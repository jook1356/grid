<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í–‰ ê·¸ë£¹í™” (Row Grouping) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="column-pinning.html">ğŸ“Œ ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html" class="active">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
  </nav>
  
  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ“‚ í–‰ ê·¸ë£¹í™” (Row Grouping)</h1>
    <span class="badge badge-implemented">êµ¬í˜„ë¨</span>
  </div>
  
  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>í–‰ ê·¸ë£¹í™”</strong>ëŠ” íŠ¹ì • ì»¬ëŸ¼ì˜ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ í–‰ì„ ê³„ì¸µì ìœ¼ë¡œ ë¬¶ì–´ í‘œì‹œí•©ë‹ˆë‹¤.
      ê·¸ë£¹ì„ ì ‘ê³  í¼ì¹  ìˆ˜ ìˆìœ¼ë©°, ê° ê·¸ë£¹ì— ëŒ€í•œ ì§‘ê³„(í•©ê³„, í‰ê· , ê°œìˆ˜ ë“±)ë„ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      ê·¸ë£¹ í—¤ë”ë¥¼ í´ë¦­í•˜ì—¬ ì ‘ê¸°/í¼ì¹˜ê¸°ë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
    </p>
  </div>
  
  <div class="demo-container">
    <div class="toolbar">
      <div class="toolbar-group">
        <label>ê·¸ë£¹ ê¸°ì¤€:</label>
        <select id="groupBySelect" onchange="applyGrouping()">
          <option value="none">ê·¸ë£¹ ì—†ìŒ</option>
          <option value="department" selected>ë¶€ì„œë³„</option>
          <option value="status">ìƒíƒœë³„</option>
          <option value="department,status">ë¶€ì„œ â†’ ìƒíƒœ (ë‹¤ì¤‘)</option>
        </select>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <button onclick="expandAll()">ğŸ“‚ ëª¨ë‘ í¼ì¹˜ê¸°</button>
        <button onclick="collapseAll()" class="secondary">ğŸ“ ëª¨ë‘ ì ‘ê¸°</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>ì§‘ê³„:</label>
        <select id="aggregateSelect" onchange="applyGrouping()">
          <option value="sum" selected>í•©ê³„</option>
          <option value="avg">í‰ê· </option>
          <option value="count">ê°œìˆ˜</option>
        </select>
      </div>
    </div>
    
    <div id="grid"></div>
    
    <div class="status-bar" id="status">
      ì¤€ë¹„ë¨ - ê·¸ë£¹ í—¤ë”ë¥¼ í´ë¦­í•˜ì—¬ ì ‘ê¸°/í¼ì¹˜ê¸°
    </div>
  </div>
  
  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²•</h3>
    <pre><span class="comment">// GridRendererë¥¼ í†µí•œ ê·¸ë£¹í™” ì„¤ì • (í—¤ë” indent ìë™ ë™ê¸°í™”)</span>
renderer.<span class="function">setGroupingConfig</span>({
  columns: [<span class="string">'department'</span>],
  aggregates: {
    salary: <span class="string">'sum'</span>,  <span class="comment">// 'sum' | 'avg' | 'count' | 'min' | 'max'</span>
  },
});

<span class="comment">// ê·¸ë£¹í™” í•´ì œ</span>
renderer.<span class="function">setGroupingConfig</span>(<span class="keyword">null</span>);

<span class="comment">// ê·¸ë£¹ ì ‘ê¸°/í¼ì¹˜ê¸° (BodyRenderer ì‚¬ìš©)</span>
<span class="keyword">const</span> bodyRenderer = renderer.<span class="function">getBodyRenderer</span>();
bodyRenderer.<span class="function">toggleGroup</span>(<span class="string">'department:Engineering'</span>);
bodyRenderer.<span class="function">expandAllGroups</span>();
bodyRenderer.<span class="function">collapseAllGroups</span>();</pre>
  </div>
  
  <!-- ê·¸ë£¹ ìƒíƒœ -->
  <div class="info-panel">
    <h3>ğŸ“Š í˜„ì¬ ê·¸ë£¹ ìƒíƒœ</h3>
    <pre id="groupState">{
  "columns": ["department"],
  "aggregate": "sum"
}</pre>
  </div>
  
  <script type="module">
    // GridCoreì™€ GridRenderer import
    const { GridCore, GridRenderer } = await import('../../src/index.ts');
    
    let gridCore = null;
    let renderer = null;
    
    // 100ê°œ ìƒ˜í”Œ ë°ì´í„° ìƒì„±
    const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„', 'í•œì§€ë¯¼', 'ê°•í˜¸ë™', 'ìœ ì¬ì„', 'ì‹ ë™ì—½', 'ì†¡í˜œêµ'];
    const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'];
    const statuses = ['Active', 'Inactive', 'Pending'];
    
    const sampleData = Array.from({ length: 100 }, (_, i) => ({
      id: i + 1,
      name: names[i % names.length] + (Math.floor(i / 10) || ''),
      department: departments[i % departments.length],
      status: statuses[i % statuses.length],
      salary: 50000 + Math.floor(Math.random() * 50000),
      joinDate: `202${Math.floor(i % 5)}-${String((i % 12) + 1).padStart(2, '0')}-${String((i % 28) + 1).padStart(2, '0')}`
    }));
    
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }
    
    function updateGroupStateDisplay() {
      const groupBy = document.getElementById('groupBySelect').value;
      const aggregate = document.getElementById('aggregateSelect').value;
      
      const state = {
        columns: groupBy === 'none' ? [] : groupBy.split(','),
        aggregate: aggregate,
      };
      
      document.getElementById('groupState').textContent = JSON.stringify(state, null, 2);
    }
    
    // ê·¸ë£¹í™” ì ìš© (GridRenderer.setGroupingConfig ì‚¬ìš©)
    window.applyGrouping = function() {
      const groupBy = document.getElementById('groupBySelect').value;
      const aggregate = document.getElementById('aggregateSelect').value;

      if (!renderer) return;

      if (groupBy === 'none') {
        // ê·¸ë£¹í™” í•´ì œ
        renderer.setGroupingConfig(null);
        updateStatus('ê·¸ë£¹ í•´ì œë¨');
      } else {
        // ê·¸ë£¹í™” ì„¤ì • (í—¤ë” indent ìë™ ë™ê¸°í™”)
        const columns = groupBy.split(',');
        renderer.setGroupingConfig({
          columns,
          aggregates: {
            salary: aggregate,
          },
        });
        updateStatus(`${columns.join(' â†’ ')} ê¸°ì¤€ ê·¸ë£¹í™”ë¨ - í—¤ë” í´ë¦­ìœ¼ë¡œ ì ‘ê¸°/í¼ì¹˜ê¸°`);
      }

      updateGroupStateDisplay();
    };
    
    // ëª¨ë“  ê·¸ë£¹ í¼ì¹˜ê¸°
    window.expandAll = function() {
      if (!renderer) return;
      const bodyRenderer = renderer.getBodyRenderer();
      if (bodyRenderer) {
        bodyRenderer.expandAllGroups();
        updateStatus('ëª¨ë“  ê·¸ë£¹ í¼ì¹¨');
      }
    };
    
    // ëª¨ë“  ê·¸ë£¹ ì ‘ê¸°
    window.collapseAll = function() {
      if (!renderer) return;
      const bodyRenderer = renderer.getBodyRenderer();
      if (bodyRenderer) {
        bodyRenderer.collapseAllGroups();
        updateStatus('ëª¨ë“  ê·¸ë£¹ ì ‘ìŒ');
      }
    };
    
    // ì´ˆê¸°í™”
    async function init() {
      const container = document.getElementById('grid');
      
      const columns = [
        { key: 'id', header: 'ID', width: 60 },
        { key: 'name', header: 'Name', width: 150 },
        { key: 'department', header: 'Department', width: 120 },
        { key: 'status', header: 'Status', width: 100 },
        { key: 'salary', header: 'Salary', width: 120, formatter: (v) => '$' + (v?.toLocaleString() || '0') },
        { key: 'joinDate', header: 'Join Date', width: 120 },
      ];
      
      gridCore = new GridCore({ columns });
      await gridCore.initialize();
      
      renderer = new GridRenderer(container, {
        gridCore,
        options: {
          columns,
          rowHeight: 36,
          headerHeight: 40,
          resizableColumns: true,
          theme: 'light',
          // ì´ˆê¸° ê·¸ë£¹í™” ì„¤ì •
          groupingConfig: {
            columns: ['department'],
            aggregates: {
              salary: 'sum',
            },
          },
        },
        onRowClick: (rowIndex, row) => {
          console.log('Row clicked:', rowIndex, row);
        },
        onGroupToggle: (groupId, collapsed) => {
          console.log('Group toggled:', groupId, collapsed);
          updateStatus(`ê·¸ë£¹ "${groupId}" ${collapsed ? 'ì ‘í˜' : 'í¼ì¹¨'}`);
        },
      });
      
      // ë°ì´í„° ë¡œë“œ
      await gridCore.loadData(sampleData);
      renderer.refresh();
      
      updateGroupStateDisplay();
      updateStatus('100ê°œ í–‰ ë¡œë“œ ì™„ë£Œ - ê·¸ë£¹ í—¤ë”ë¥¼ í´ë¦­í•˜ì—¬ ì ‘ê¸°/í¼ì¹˜ê¸°');
    }
    
    init().catch(console.error);
  </script>
</body>
</html>
