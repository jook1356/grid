<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í–‰ ê·¸ë£¹í™” (Row Grouping) - PureSheet Demo</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../../src/ui/style/default.css">
  <style>
    /* ê·¸ë£¹í™” ë¯¸ë¦¬ë³´ê¸°ìš© ìŠ¤íƒ€ì¼ */
    .preview-grid {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      font-size: 14px;
    }
    
    .preview-header {
      display: grid;
      grid-template-columns: 40px 200px 120px 100px 100px 120px;
      background: #f5f5f5;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .preview-header-cell {
      padding: 12px;
      font-weight: 600;
      border-right: 1px solid #e0e0e0;
    }
    
    .preview-header-cell:last-child {
      border-right: none;
    }
    
    /* ê·¸ë£¹ í—¤ë” */
    .group-header {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      background: linear-gradient(to right, #e3f2fd, #fff);
      border-bottom: 1px solid #e0e0e0;
      cursor: pointer;
      user-select: none;
      transition: background 0.2s;
    }
    
    .group-header:hover {
      background: linear-gradient(to right, #bbdefb, #fff);
    }
    
    .group-header.level-2 {
      padding-left: 32px;
      background: linear-gradient(to right, #fff3e0, #fff);
    }
    
    .group-header.level-2:hover {
      background: linear-gradient(to right, #ffe0b2, #fff);
    }
    
    .group-toggle {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
      font-size: 12px;
      color: #666;
      transition: transform 0.2s;
    }
    
    .group-toggle.collapsed {
      transform: rotate(-90deg);
    }
    
    .group-label {
      font-weight: 600;
      flex: 1;
    }
    
    .group-count {
      background: #1976d2;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
      margin-right: 12px;
    }
    
    .group-aggregate {
      display: flex;
      gap: 16px;
      font-size: 13px;
      color: #666;
    }
    
    .group-aggregate .value {
      font-weight: 600;
      color: #333;
    }
    
    /* ë°ì´í„° í–‰ */
    .data-row {
      display: grid;
      grid-template-columns: 40px 200px 120px 100px 100px 120px;
      border-bottom: 1px solid #e8e8e8;
      transition: background 0.15s;
    }
    
    .data-row:hover {
      background: #f8f9fa;
    }
    
    .data-row.indent-1 .indent-cell {
      padding-left: 32px;
    }
    
    .data-row.indent-2 .indent-cell {
      padding-left: 52px;
    }
    
    .data-cell {
      padding: 10px 12px;
      border-right: 1px solid #e8e8e8;
    }
    
    .data-cell:last-child {
      border-right: none;
    }
    
    .data-cell.checkbox {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .data-cell.salary {
      text-align: right;
      font-weight: 500;
      color: #2e7d32;
    }
    
    /* ìƒíƒœ ë°°ì§€ */
    .status-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-badge.active {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .status-badge.inactive {
      background: #ffebee;
      color: #c62828;
    }
    
    .status-badge.pending {
      background: #fff3e0;
      color: #e65100;
    }
    
    /* ìˆ¨ê¹€ */
    .hidden {
      display: none !important;
    }
    
    /* ì§‘ê³„ í–‰ */
    .aggregate-footer {
      display: grid;
      grid-template-columns: 40px 200px 120px 100px 100px 120px;
      background: #fafafa;
      border-top: 2px solid #e0e0e0;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="demo-nav">
    <a href="../index.html">ğŸ  í™ˆ</a>
    <a href="column-pinning.html">ğŸ“Œ ì»¬ëŸ¼ ê³ ì •</a>
    <a href="multi-row.html">ğŸ“‘ Multi-Row</a>
    <a href="grouping.html" class="active">ğŸ“‚ í–‰ ê·¸ë£¹í™”</a>
  </nav>
  
  <!-- í—¤ë” -->
  <div class="demo-header">
    <h1>ğŸ“‚ í–‰ ê·¸ë£¹í™” (Row Grouping)</h1>
    <span class="badge badge-planned">2ì°¨ êµ¬í˜„ ì˜ˆì •</span>
  </div>
  
  <!-- ì„¤ëª… -->
  <div class="demo-description">
    <p>
      <strong>í–‰ ê·¸ë£¹í™”</strong>ëŠ” íŠ¹ì • ì»¬ëŸ¼ì˜ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ í–‰ì„ ê³„ì¸µì ìœ¼ë¡œ ë¬¶ì–´ í‘œì‹œí•©ë‹ˆë‹¤.
      ê·¸ë£¹ì„ ì ‘ê³  í¼ì¹  ìˆ˜ ìˆìœ¼ë©°, ê° ê·¸ë£¹ì— ëŒ€í•œ ì§‘ê³„(í•©ê³„, í‰ê· , ê°œìˆ˜ ë“±)ë„ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      <code>groupBy()</code> APIë¡œ ë‹¤ì¤‘ ë ˆë²¨ ê·¸ë£¹í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    </p>
  </div>
  
  <div class="demo-container">
    <div class="toolbar">
      <div class="toolbar-group">
        <label>ê·¸ë£¹ ê¸°ì¤€:</label>
        <select id="groupBySelect" onchange="applyGrouping()">
          <option value="none">ê·¸ë£¹ ì—†ìŒ</option>
          <option value="department" selected>ë¶€ì„œë³„</option>
          <option value="status">ìƒíƒœë³„</option>
          <option value="department,status">ë¶€ì„œ â†’ ìƒíƒœ (ë‹¤ì¤‘)</option>
        </select>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <button onclick="expandAll()">ğŸ“‚ ëª¨ë‘ í¼ì¹˜ê¸°</button>
        <button onclick="collapseAll()" class="secondary">ğŸ“ ëª¨ë‘ ì ‘ê¸°</button>
      </div>
      
      <div class="toolbar-divider"></div>
      
      <div class="toolbar-group">
        <label>ì§‘ê³„:</label>
        <select id="aggregateSelect" onchange="applyGrouping()">
          <option value="sum" selected>í•©ê³„</option>
          <option value="avg">í‰ê· </option>
          <option value="count">ê°œìˆ˜</option>
        </select>
      </div>
    </div>
    
    <!-- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
    <div id="grid" style="height: 500px; overflow: auto;">
      <div class="preview-grid" id="previewGrid">
        <!-- JavaScriptë¡œ ë Œë”ë§ -->
      </div>
    </div>
    
    <div class="status-bar" id="status">
      ë¯¸ë¦¬ë³´ê¸° - ê·¸ë£¹ í—¤ë”ë¥¼ í´ë¦­í•˜ì—¬ ì ‘ê¸°/í¼ì¹˜ê¸°
    </div>
  </div>
  
  <!-- ì½”ë“œ ì˜ˆì œ -->
  <div class="code-example">
    <h3>API ì‚¬ìš©ë²•</h3>
    <pre><span class="comment">// ì»¬ëŸ¼ ì •ì˜ì—ì„œ ê·¸ë£¹í™” ì„¤ì •</span>
<span class="keyword">const</span> columns = [
  { key: <span class="string">'department'</span>, groupable: <span class="keyword">true</span>, groupOrder: <span class="number">1</span> },
  { key: <span class="string">'status'</span>, groupable: <span class="keyword">true</span>, groupOrder: <span class="number">2</span> },
  { key: <span class="string">'salary'</span>, aggregate: <span class="string">'sum'</span> },  <span class="comment">// ì§‘ê³„ í•¨ìˆ˜</span>
];

<span class="comment">// APIë¡œ ê·¸ë£¹í™” ì ìš©</span>
sheet.<span class="function">groupBy</span>([<span class="string">'department'</span>]);              <span class="comment">// ë‹¨ì¼ ê·¸ë£¹</span>
sheet.<span class="function">groupBy</span>([<span class="string">'department'</span>, <span class="string">'status'</span>]);    <span class="comment">// ë‹¤ì¤‘ ê·¸ë£¹</span>

<span class="comment">// ê·¸ë£¹ ì ‘ê¸°/í¼ì¹˜ê¸°</span>
sheet.<span class="function">collapseGroup</span>(<span class="string">'department'</span>, <span class="string">'Engineering'</span>);
sheet.<span class="function">expandGroup</span>(<span class="string">'department'</span>, <span class="string">'Engineering'</span>);
sheet.<span class="function">expandAll</span>();
sheet.<span class="function">collapseAll</span>();

<span class="comment">// ì§‘ê³„ í•¨ìˆ˜ ì„¤ì •</span>
sheet.<span class="function">setAggregation</span>(<span class="string">'salary'</span>, <span class="string">'avg'</span>);  <span class="comment">// sum, avg, min, max, count</span></pre>
  </div>
  
  <!-- ì¶”ê°€ ì •ë³´ -->
  <div class="info-panel">
    <h3>ğŸ” ê·¸ë£¹í™” ì˜µì…˜</h3>
    <pre>1. ì§‘ê³„ í•¨ìˆ˜
   - sum: í•©ê³„
   - avg: í‰ê· 
   - min: ìµœì†Ÿê°’
   - max: ìµœëŒ“ê°’
   - count: ê°œìˆ˜

2. ê·¸ë£¹ í‘œì‹œ ì˜µì…˜
   - ê·¸ë£¹ í—¤ë”ì— ì§‘ê³„ê°’ í‘œì‹œ
   - ê·¸ë£¹ í‘¸í„°ì— ì†Œê³„ í‘œì‹œ (ì„ íƒ)
   - ìµœì¢… í•©ê³„ í–‰ í‘œì‹œ (ì„ íƒ)

3. ë‹¤ì¤‘ ê·¸ë£¹
   - ìµœëŒ€ Nê°œ ë ˆë²¨ ì§€ì›
   - ê° ë ˆë²¨ë³„ ë“¤ì—¬ì“°ê¸°
   - ê³„ì¸µì  ì ‘ê¸°/í¼ì¹˜ê¸°

4. ì„±ëŠ¥ ìµœì í™”
   - ì ‘íŒ ê·¸ë£¹ì˜ í–‰ì€ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
   - ê°€ìƒí™”ì™€ í•¨ê»˜ ì‘ë™</pre>
  </div>
  
  <script>
    // 100ê°œ ìƒ˜í”Œ ë°ì´í„° ìƒì„±
    const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„', 'í•œì§€ë¯¼', 'ê°•í˜¸ë™', 'ìœ ì¬ì„', 'ì‹ ë™ì—½', 'ì†¡í˜œêµ'];
    const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'];
    const statuses = ['Active', 'Inactive', 'Pending'];
    
    const sampleData = Array.from({ length: 100 }, (_, i) => ({
      id: i + 1,
      name: names[i % names.length] + (Math.floor(i / 10) || ''),
      department: departments[i % departments.length],
      status: statuses[i % statuses.length],
      salary: 50000 + Math.floor(Math.random() * 50000),
      joinDate: `202${Math.floor(i % 5)}-${String((i % 12) + 1).padStart(2, '0')}-${String((i % 28) + 1).padStart(2, '0')}`
    }));
    
    // ê·¸ë£¹ ìƒíƒœ
    let collapsedGroups = new Set();
    
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }
    
    function getStatusBadge(status) {
      const classes = {
        'Active': 'active',
        'Inactive': 'inactive',
        'Pending': 'pending'
      };
      return `<span class="status-badge ${classes[status] || ''}">${status}</span>`;
    }
    
    function calculateAggregate(data, key, fn) {
      const values = data.map(d => d[key]).filter(v => typeof v === 'number');
      switch (fn) {
        case 'sum': return values.reduce((a, b) => a + b, 0);
        case 'avg': return values.length ? Math.round(values.reduce((a, b) => a + b, 0) / values.length) : 0;
        case 'count': return values.length;
        case 'min': return Math.min(...values);
        case 'max': return Math.max(...values);
        default: return values.reduce((a, b) => a + b, 0);
      }
    }
    
    window.applyGrouping = function() {
      const groupBy = document.getElementById('groupBySelect').value;
      const aggregate = document.getElementById('aggregateSelect').value;
      const grid = document.getElementById('previewGrid');
      
      if (groupBy === 'none') {
        renderFlatGrid(grid, aggregate);
        return;
      }
      
      const groupFields = groupBy.split(',');
      renderGroupedGrid(grid, groupFields, aggregate);
    };
    
    function renderFlatGrid(grid, aggregate) {
      let html = `
        <div class="preview-header">
          <div class="preview-header-cell">âœ“</div>
          <div class="preview-header-cell">ì´ë¦„</div>
          <div class="preview-header-cell">ë¶€ì„œ</div>
          <div class="preview-header-cell">ìƒíƒœ</div>
          <div class="preview-header-cell">ê¸‰ì—¬</div>
          <div class="preview-header-cell">ì…ì‚¬ì¼</div>
        </div>
      `;
      
      sampleData.forEach(row => {
        html += `
          <div class="data-row">
            <div class="data-cell checkbox"><input type="checkbox"></div>
            <div class="data-cell">${row.name}</div>
            <div class="data-cell">${row.department}</div>
            <div class="data-cell">${getStatusBadge(row.status)}</div>
            <div class="data-cell salary">$${row.salary.toLocaleString()}</div>
            <div class="data-cell">${row.joinDate}</div>
          </div>
        `;
      });
      
      // í•©ê³„ í–‰
      const total = calculateAggregate(sampleData, 'salary', aggregate);
      const aggregateLabel = { sum: 'í•©ê³„', avg: 'í‰ê· ', count: 'ê°œìˆ˜' }[aggregate];
      
      html += `
        <div class="aggregate-footer">
          <div class="data-cell"></div>
          <div class="data-cell">${aggregateLabel}</div>
          <div class="data-cell"></div>
          <div class="data-cell">${sampleData.length}ëª…</div>
          <div class="data-cell salary">$${total.toLocaleString()}</div>
          <div class="data-cell"></div>
        </div>
      `;
      
      grid.innerHTML = html;
      updateStatus('ê·¸ë£¹ ì—†ìŒ - ëª¨ë“  í–‰ í‘œì‹œ');
    }
    
    function renderGroupedGrid(grid, groupFields, aggregate) {
      let html = `
        <div class="preview-header">
          <div class="preview-header-cell">âœ“</div>
          <div class="preview-header-cell">ì´ë¦„</div>
          <div class="preview-header-cell">ë¶€ì„œ</div>
          <div class="preview-header-cell">ìƒíƒœ</div>
          <div class="preview-header-cell">ê¸‰ì—¬</div>
          <div class="preview-header-cell">ì…ì‚¬ì¼</div>
        </div>
      `;
      
      const aggregateLabel = { sum: 'í•©ê³„', avg: 'í‰ê· ', count: 'ê°œìˆ˜' }[aggregate];
      
      if (groupFields.length === 1) {
        // ë‹¨ì¼ ë ˆë²¨ ê·¸ë£¹í™”
        const field = groupFields[0];
        const groups = {};
        
        sampleData.forEach(row => {
          const key = row[field];
          if (!groups[key]) groups[key] = [];
          groups[key].push(row);
        });
        
        Object.entries(groups).forEach(([groupKey, rows]) => {
          const groupId = `${field}:${groupKey}`;
          const isCollapsed = collapsedGroups.has(groupId);
          const total = calculateAggregate(rows, 'salary', aggregate);
          
          html += `
            <div class="group-header" onclick="toggleGroup('${groupId}')">
              <div class="group-toggle ${isCollapsed ? 'collapsed' : ''}">â–¼</div>
              <div class="group-label">
                ${field === 'department' ? 'ğŸ¢' : 'ğŸ“Š'} ${groupKey}
              </div>
              <div class="group-count">${rows.length}</div>
              <div class="group-aggregate">
                <span>${aggregateLabel}: <span class="value">$${total.toLocaleString()}</span></span>
              </div>
            </div>
          `;
          
          rows.forEach(row => {
            html += `
              <div class="data-row indent-1 ${isCollapsed ? 'hidden' : ''}" data-group="${groupId}">
                <div class="data-cell checkbox"><input type="checkbox"></div>
                <div class="data-cell indent-cell">${row.name}</div>
                <div class="data-cell">${row.department}</div>
                <div class="data-cell">${getStatusBadge(row.status)}</div>
                <div class="data-cell salary">$${row.salary.toLocaleString()}</div>
                <div class="data-cell">${row.joinDate}</div>
              </div>
            `;
          });
        });
        
      } else if (groupFields.length === 2) {
        // ë‹¤ì¤‘ ë ˆë²¨ ê·¸ë£¹í™”
        const [field1, field2] = groupFields;
        const groups = {};
        
        sampleData.forEach(row => {
          const key1 = row[field1];
          const key2 = row[field2];
          if (!groups[key1]) groups[key1] = {};
          if (!groups[key1][key2]) groups[key1][key2] = [];
          groups[key1][key2].push(row);
        });
        
        Object.entries(groups).forEach(([groupKey1, subGroups]) => {
          const groupId1 = `${field1}:${groupKey1}`;
          const isCollapsed1 = collapsedGroups.has(groupId1);
          const allRows = Object.values(subGroups).flat();
          const total1 = calculateAggregate(allRows, 'salary', aggregate);
          
          html += `
            <div class="group-header" onclick="toggleGroup('${groupId1}')">
              <div class="group-toggle ${isCollapsed1 ? 'collapsed' : ''}">â–¼</div>
              <div class="group-label">ğŸ¢ ${groupKey1}</div>
              <div class="group-count">${allRows.length}</div>
              <div class="group-aggregate">
                <span>${aggregateLabel}: <span class="value">$${total1.toLocaleString()}</span></span>
              </div>
            </div>
          `;
          
          Object.entries(subGroups).forEach(([groupKey2, rows]) => {
            const groupId2 = `${groupId1}/${field2}:${groupKey2}`;
            const isCollapsed2 = collapsedGroups.has(groupId2);
            const total2 = calculateAggregate(rows, 'salary', aggregate);
            
            html += `
              <div class="group-header level-2 ${isCollapsed1 ? 'hidden' : ''}" 
                   onclick="event.stopPropagation(); toggleGroup('${groupId2}')"
                   data-parent="${groupId1}">
                <div class="group-toggle ${isCollapsed2 ? 'collapsed' : ''}">â–¼</div>
                <div class="group-label">ğŸ“Š ${groupKey2}</div>
                <div class="group-count">${rows.length}</div>
                <div class="group-aggregate">
                  <span>${aggregateLabel}: <span class="value">$${total2.toLocaleString()}</span></span>
                </div>
              </div>
            `;
            
            rows.forEach(row => {
              html += `
                <div class="data-row indent-2 ${isCollapsed1 || isCollapsed2 ? 'hidden' : ''}" 
                     data-group="${groupId2}" data-parent="${groupId1}">
                  <div class="data-cell checkbox"><input type="checkbox"></div>
                  <div class="data-cell indent-cell">${row.name}</div>
                  <div class="data-cell">${row.department}</div>
                  <div class="data-cell">${getStatusBadge(row.status)}</div>
                  <div class="data-cell salary">$${row.salary.toLocaleString()}</div>
                  <div class="data-cell">${row.joinDate}</div>
                </div>
              `;
            });
          });
        });
      }
      
      // ì „ì²´ í•©ê³„
      const grandTotal = calculateAggregate(sampleData, 'salary', aggregate);
      html += `
        <div class="aggregate-footer">
          <div class="data-cell"></div>
          <div class="data-cell">ì „ì²´ ${aggregateLabel}</div>
          <div class="data-cell"></div>
          <div class="data-cell">${sampleData.length}ëª…</div>
          <div class="data-cell salary">$${grandTotal.toLocaleString()}</div>
          <div class="data-cell"></div>
        </div>
      `;
      
      grid.innerHTML = html;
      updateStatus(`${groupFields.join(' â†’ ')} ê¸°ì¤€ ê·¸ë£¹í™” - í—¤ë” í´ë¦­ìœ¼ë¡œ ì ‘ê¸°/í¼ì¹˜ê¸°`);
    }
    
    window.toggleGroup = function(groupId) {
      if (collapsedGroups.has(groupId)) {
        collapsedGroups.delete(groupId);
      } else {
        collapsedGroups.add(groupId);
      }
      applyGrouping();
    };
    
    window.expandAll = function() {
      collapsedGroups.clear();
      applyGrouping();
      updateStatus('ëª¨ë“  ê·¸ë£¹ í¼ì¹¨');
    };
    
    window.collapseAll = function() {
      const groupBy = document.getElementById('groupBySelect').value;
      if (groupBy === 'none') return;
      
      const groupFields = groupBy.split(',');
      
      // ìµœìƒìœ„ ê·¸ë£¹ë§Œ ì ‘ê¸°
      if (groupFields[0] === 'department') {
        ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'].forEach(dept => {
          collapsedGroups.add(`department:${dept}`);
        });
      } else if (groupFields[0] === 'status') {
        ['Active', 'Inactive', 'Pending'].forEach(status => {
          collapsedGroups.add(`status:${status}`);
        });
      }
      
      applyGrouping();
      updateStatus('ëª¨ë“  ê·¸ë£¹ ì ‘ìŒ');
    };
    
    // ì´ˆê¸° ë Œë”ë§
    applyGrouping();
  </script>
</body>
</html>
